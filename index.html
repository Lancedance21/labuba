<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script>
        // –ï—Å–ª–∏ keys.js –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –ø—É—Å—Ç—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, —á—Ç–æ–±—ã —Å–∞–π—Ç –Ω–µ —É–º–µ—Ä
        window.GOOGLE_API_KEYS = []; 
        window.CONFIG = { GOOGLE_AI: { API_KEYS: [] } };
        console.log("üöë –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∫–ª—é—á–µ–π –≤–∫–ª—é—á–µ–Ω–∞");
    </script>
    
    <script src="keys.js?v=2.0" onerror="console.log('GitHub —Ä–µ–∂–∏–º: keys.js –ø—Ä–æ–ø—É—â–µ–Ω')"></script>
    ...
<script src="config.js?v=2.0"></script>
<script src="api/musicbrainz.js"></script>
<script src="js/ai-core.js?v=3.0"></script>
    <link rel="stylesheet" href="styles/custom.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéµ –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ò–ò —Å –Ω–µ–π—Ä–æ—Å–µ—Ç—å—é | –ë–µ—Å–ø–ª–∞—Ç–Ω–æ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Transformers.js –¥–ª—è –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ -->
    <script src="https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.0"></script>
    // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è - –∂–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
window.addEventListener('load', async function() {
    console.log("üöÄ –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã");
    
    // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é ai-core
    setTimeout(() => {
        if (window.aiCore) {
            console.log("‚úÖ AI Core –Ω–∞–π–¥–µ–Ω, –∫–ª—é—á–µ–π:", window.aiCore.apiKeys.length);
            
            // –ï—Å–ª–∏ –∫–ª—é—á–µ–π –Ω–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            if (window.aiCore.apiKeys.length === 0) {
                console.log("‚ö†Ô∏è –ù–µ—Ç –∫–ª—é—á–µ–π, –ø–æ–∫–∞–∑—ã–≤–∞—é –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ");
                const modal = document.getElementById('settingsModal');
                if (modal) {
                    modal.classList.remove('hidden');
                    modal.style.display = 'flex';
                }
            } else {
                console.log("‚úÖ –ö–ª—é—á–∏ –µ—Å—Ç—å, –Ω–∞—á–∏–Ω–∞–µ–º —Ä–∞–±–æ—Ç—É");
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
                document.getElementById('sendMessage').disabled = false;
                document.getElementById('chatInput').placeholder = "–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –æ –º—É–∑—ã–∫–µ...";
            }
        } else {
            console.error("‚ùå AI Core –Ω–µ –Ω–∞–π–¥–µ–Ω!");
        }
    }, 1000);
});
    <style>
        /* –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –º—É–∑—ã–∫–∞–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        :root {
            --primary: #6366f1;
            --secondary: #8b5cf6;
            --accent: #06b6d4;
            --dark: #0f172a;
            --darker: #020617;
            --light: #f1f5f9;
            --gray: #94a3b8;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
            --gradient2: linear-gradient(135deg, var(--accent), var(--primary));
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            --glow: 0 0 30px rgba(99, 102, 241, 0.3);
        }

        body {
            background: var(--darker);
            color: var(--light);
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(6, 182, 212, 0.1) 0%, transparent 50%),
                linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 10% 20%, rgba(99, 102, 241, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 40%);
            pointer-events: none;
            z-index: 0;
            animation: backgroundShift 20s ease-in-out infinite;
        }

        @keyframes backgroundShift {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.1); }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        @keyframes slideIn {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes neuralGlow {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(99, 102, 241, 0.3),
                            inset 0 0 20px rgba(99, 102, 241, 0.1);
            }
            50% { 
                box-shadow: 0 0 40px rgba(99, 102, 241, 0.5),
                            inset 0 0 30px rgba(99, 102, 241, 0.2);
            }
        }

        @keyframes thinking {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            animation: slideIn 0.8s ease-out;
            position: relative;
            z-index: 1;
        }

        /* –•–µ–¥–µ—Ä */
        .header {
            text-align: center;
            padding: 50px 20px;
            position: relative;
        }

        .neural-badge {
            display: inline-block;
            background: var(--gradient);
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 1.2rem;
            margin-bottom: 30px;
            animation: pulse 2s infinite;
            border: 2px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        h1 {
            font-size: 4rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 20px;
            text-shadow: 0 0 50px rgba(99, 102, 241, 0.3);
            animation: float 3s ease-in-out infinite;
        }

        .subtitle {
            font-size: 1.4rem;
            color: var(--gray);
            max-width: 800px;
            margin: 0 auto 40px;
            line-height: 1.6;
        }

        /* –ù–µ–π—Ä–æ—Å–µ—Ç—å —Å—Ç–∞—Ç—É—Å */
        .neural-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid var(--glass-border);
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }

        .status-dot.thinking {
            background: var(--warning);
            animation: thinking 1s infinite;
        }

        /* –û—Å–Ω–æ–≤–Ω–∞—è —Å–µ—Ç–∫–∞ */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 50px;
        }

        @media (max-width: 1100px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.02) 100%);
            backdrop-filter: blur(30px);
            border-radius: 30px;
            padding: 35px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(255, 255, 255, 0.05) inset,
                0 0 100px rgba(99, 102, 241, 0.1);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, 
                var(--primary) 0%, 
                var(--secondary) 50%, 
                var(--accent) 100%);
            background-size: 200% 100%;
            animation: gradientShift 3s ease infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .card::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none;
        }

        .card:hover {
            transform: translateY(-8px) scale(1.01);
            box-shadow: 
                0 30px 80px rgba(0, 0, 0, 0.4),
                0 0 0 1px rgba(255, 255, 255, 0.1) inset,
                0 0 150px rgba(99, 102, 241, 0.2);
            border-color: rgba(99, 102, 241, 0.4);
        }

        .card:hover::after {
            opacity: 1;
        }

        .card.neural-core {
            animation: neuralGlow 3s infinite;
            border: 2px solid rgba(99, 102, 241, 0.2);
        }

        .card-title {
            font-size: 2rem;
            color: var(--light);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .card-title i {
            font-size: 2.2rem;
            color: var(--accent);
        }

        /* –ß–∞—Ç —Å –Ω–µ–π—Ä–æ—Å–µ—Ç—å—é */
        .chat-container {
            height: 600px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.2) 100%);
            border-radius: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 10px;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--secondary), var(--accent));
        }

        /* –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ –±–æ–∫–∞–º */
        .side-decoration {
            position: fixed;
            top: 0;
            width: 200px;
            height: 100vh;
            pointer-events: none;
            z-index: 1;
        }

        .side-decoration.left {
            left: 0;
        }

        .side-decoration.right {
            right: 0;
        }

        .floating-element {
            position: absolute;
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
            border-radius: 50%;
            filter: blur(40px);
            animation: floatSide 8s ease-in-out infinite;
            opacity: 0.6;
        }

        @keyframes floatSide {
            0%, 100% { 
                transform: translateX(0) translateY(0) scale(1);
                opacity: 0.6;
            }
            25% { 
                transform: translateX(30px) translateY(-20px) scale(1.2);
                opacity: 0.8;
            }
            50% { 
                transform: translateX(-20px) translateY(30px) scale(0.8);
                opacity: 0.4;
            }
            75% { 
                transform: translateX(20px) translateY(20px) scale(1.1);
                opacity: 0.7;
            }
        }

        /* –ë–æ–∫–æ–≤—ã–µ –ø–∞–Ω–µ–ª–∏ */
        .side-panel {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            width: 180px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.03) 100%);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            z-index: 5;
            transition: all 0.4s ease;
        }

        .side-panel.left-panel {
            left: 20px;
        }

        .side-panel.right-panel {
            right: 20px;
        }

        .side-panel:hover {
            transform: translateY(-50%) scale(1.05);
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.4);
        }

        .panel-content h3 {
            font-size: 1.1rem;
            margin-bottom: 20px;
            color: var(--light);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-content h3 i {
            color: var(--primary);
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .genre-tag {
            display: inline-block;
            padding: 8px 15px;
            margin: 5px 5px 5px 0;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 15px;
            font-size: 0.85rem;
            color: var(--light);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .genre-tag:hover {
            background: var(--gradient);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.4);
        }

        /* –ì–ª–∞–≤–Ω—ã–π layout */
        .main-layout {
            display: grid;
            grid-template-columns: 280px 1fr 280px;
            gap: 20px;
            min-height: 100vh;
            padding: 20px;
            max-width: 1800px;
            margin: 0 auto;
        }

        @media (max-width: 1400px) {
            .main-layout {
                grid-template-columns: 250px 1fr 250px;
            }
        }

        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 220px 1fr;
            }
            .right-sidebar {
                display: none;
            }
        }

        @media (max-width: 900px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            .left-sidebar {
                display: none;
            }
        }

        /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */
        .sidebar {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.03) 100%);
            backdrop-filter: blur(30px);
            border-radius: 25px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            height: fit-content;
            position: sticky;
            top: 20px;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }

        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: var(--gradient);
            border-radius: 10px;
        }

        .sidebar-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            font-size: 0.85rem;
        }

        .sidebar-section {
            margin-bottom: 30px;
        }

        .sidebar-section h3 {
            font-size: 1rem;
            color: var(--light);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-section h3 i {
            color: var(--primary);
        }

        .search-type-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .search-type-btn {
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            color: var(--light);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.9rem;
            text-align: left;
        }

        .search-type-btn:hover {
            background: rgba(99, 102, 241, 0.2);
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .search-type-btn.active {
            background: var(--gradient);
            border-color: transparent;
            color: white;
        }

        .search-type-btn i {
            font-size: 1.2rem;
            width: 20px;
        }


        /* –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —á–∞—Ç */
        .main-chat-container {
            display: flex;
            flex-direction: column;
        }

        .chat-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            backdrop-filter: blur(30px);
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            height: calc(100vh - 100px);
            max-height: none;
            min-height: 900px;
            overflow: hidden;
        }

        .chat-header {
            padding: 20px 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.2);
        }

        .chat-header h2 {
            font-size: 1.5rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            min-height: 0;
        }

        .voice-status {
            text-align: center;
            margin-top: 10px;
            color: var(--gray);
            font-size: 0.9rem;
            display: none;
            padding: 10px;
            background: rgba(239, 68, 68, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .voice-status.active {
            display: block;
        }

        .voice-status i {
            color: var(--danger);
            animation: pulse 1s infinite;
            margin-right: 8px;
        }

        /* –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è */
        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quick-btn {
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: var(--light);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 0.9rem;
        }

        .quick-btn:hover {
            background: rgba(99, 102, 241, 0.2);
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .recent-finds {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .recent-find-item {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: var(--light);
        }

        .recent-find-item:last-child {
            border-bottom: none;
        }

        /* –®–∞–ø–∫–∞ —Å–∞–π—Ç–∞ */
        .site-header {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.15) 100%);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 25px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
        }

        .header-content {
            max-width: 1800px;
            margin: 0 auto;
            padding: 0 30px;
            text-align: center;
        }

        .site-title {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #06b6d4 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 8px;
            letter-spacing: -1px;
            text-shadow: 0 0 80px rgba(99, 102, 241, 0.5);
            animation: float 4s ease-in-out infinite;
        }

        .header-subtitle {
            font-size: 0.95rem;
            color: var(--gray);
            font-weight: 500;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        @media (max-width: 768px) {
            .site-title {
                font-size: 1.8rem;
            }
            .header-subtitle {
                font-size: 0.8rem;
            }
        }

        .message {
            margin-bottom: 25px;
            animation: slideIn 0.3s ease-out;
        }

        .message.ai .message-content {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.15) 100%);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 20px 20px 20px 5px;
            padding: 20px;
            position: relative;
            backdrop-filter: blur(10px);
            box-shadow: 0 5px 20px rgba(99, 102, 241, 0.2);
            text-decoration: none !important; /* –£–±–∏—Ä–∞–µ–º –∑–∞—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ */
        }
        
        .message.ai .message-content,
        .message.ai .message-content *,
        .message.ai .message-content *::before,
        .message.ai .message-content *::after {
            text-decoration: none !important; /* –£–±–∏—Ä–∞–µ–º –∑–∞—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ –≤–µ–∑–¥–µ */
            text-decoration-line: none !important;
            text-decoration-style: none !important;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.2) 0%, rgba(99, 102, 241, 0.15) 100%);
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 20px 20px 5px 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 5px 20px rgba(6, 182, 212, 0.2);
        }

        .message-sender {
            font-size: 0.95rem;
            color: var(--accent);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .neural-signature {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* –í–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è */
        .chat-input-container {
            display: flex;
            gap: 15px;
            position: relative;
            align-items: center;
        }

        .voice-btn {
            padding: 15px 20px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 15px;
            color: var(--light);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 50px;
            position: relative;
            overflow: hidden;
            margin-left: 15px;
        }

        .voice-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
        }

        .voice-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .voice-btn:hover {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.4) 0%, rgba(139, 92, 246, 0.4) 100%);
            border-color: var(--primary);
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(99, 102, 241, 0.5);
        }

        .voice-btn.listening {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            border-color: var(--danger);
            animation: voicePulse 1.5s ease-in-out infinite;
            box-shadow: 0 0 40px rgba(239, 68, 68, 0.6);
        }

        @keyframes voicePulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 40px rgba(239, 68, 68, 0.6);
            }
            50% { 
                transform: scale(1.1);
                box-shadow: 0 0 60px rgba(239, 68, 68, 0.9);
            }
        }

        .search-type-btn {
            padding: 20px 25px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            color: var(--light);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
            font-weight: 500;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .search-type-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .search-type-btn:hover::before {
            left: 100%;
        }

        .search-type-btn:hover {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
            border-color: rgba(99, 102, 241, 0.5);
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }

        .search-type-btn.active {
            background: var(--gradient);
            border-color: transparent;
            color: white;
            box-shadow: 0 10px 40px rgba(99, 102, 241, 0.4);
            transform: translateY(-3px) scale(1.03);
        }

        .search-type-btn i {
            font-size: 2rem;
            color: var(--primary);
            transition: all 0.3s ease;
            filter: drop-shadow(0 0 10px rgba(99, 102, 241, 0.5));
        }

        .search-type-btn:hover i {
            transform: scale(1.2) rotate(5deg);
            filter: drop-shadow(0 0 15px rgba(99, 102, 241, 0.8));
        }

        .search-type-btn.active i {
            color: white;
            filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.8));
        }

        #chatInput {
            flex: 1;
            padding: 20px 25px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.03) 100%);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            color: var(--light);
            font-size: 1.1rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
        }

        #chatInput:focus {
            outline: none;
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.12) 0%, rgba(255, 255, 255, 0.05) 100%);
            box-shadow: 
                0 0 30px rgba(99, 102, 241, 0.4),
                0 0 0 3px rgba(99, 102, 241, 0.1);
            transform: scale(1.02);
        }

        #sendMessage {
            padding: 18px 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            border: none;
            border-radius: 50px;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 700;
            min-width: 200px;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 15px 35px rgba(102, 126, 234, 0.4),
                0 5px 15px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        #sendMessage::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: rotate(45deg);
            transition: left 0.6s ease;
        }

        #sendMessage:hover:not(:disabled)::before {
            left: 100%;
        }

        #sendMessage::after {
            content: '‚ú®';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            opacity: 0;
            transition: all 0.4s ease;
        }

        #sendMessage:hover:not(:disabled) {
            transform: scale(1.08) translateY(-3px);
            box-shadow: 
                0 25px 50px rgba(102, 126, 234, 0.6),
                0 10px 20px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            background: linear-gradient(135deg, #764ba2 0%, #f093fb 50%, #667eea 100%);
        }

        #sendMessage:hover:not(:disabled)::after {
            opacity: 0.3;
            animation: sparkle 1s ease infinite;
        }

        #sendMessage:active:not(:disabled) {
            transform: scale(0.95);
        }

        @keyframes sparkle {
            0%, 100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
            50% { transform: translate(-50%, -50%) scale(1.5) rotate(180deg); }
        }

        #sendMessage:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* –ü–æ–∏—Å–∫ –º—É–∑—ã–∫–∏ */
        .search-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .search-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
        }

        .search-card:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--glass-border);
            transform: translateY(-5px);
        }

        .search-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .search-title {
            font-size: 1.3rem;
            color: var(--light);
            margin-bottom: 10px;
        }

        .search-desc {
            color: var(--gray);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        /* –ù–µ–π—Ä–æ—Å–µ—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è */
        .neural-info {
            background: rgba(99, 102, 241, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .model-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .model-badge {
            background: var(--gradient);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* –ó–∞–≥—Ä—É–∑–∫–∞ */
        .loading {
            text-align: center;
            padding: 50px;
        }

        .neural-spinner {
            width: 70px;
            height: 70px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid var(--primary);
            border-right: 4px solid var(--secondary);
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
            margin: 0 auto 25px;
            position: relative;
        }

        .neural-spinner::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            border: 2px solid rgba(99, 102, 241, 0.2);
            border-radius: 50%;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞ - —É–±—Ä–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —á–µ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç */

        /* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */
        .results-section {
            margin: 50px 0;
        }

        .section-title {
            font-size: 2.5rem;
            color: var(--light);
            margin-bottom: 35px;
            text-align: center;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }

        .song-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid var(--glass-border);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .song-card:hover {
            transform: translateY(-8px);
            border-color: var(--primary);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .song-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient);
        }

        .song-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .song-avatar {
            width: 60px;
            height: 60px;
            background: var(--gradient);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
        }

        .song-info h3 {
            font-size: 1.4rem;
            color: var(--light);
            margin-bottom: 5px;
        }

        .song-info p {
            color: var(--accent);
            font-size: 1.1rem;
        }

        .song-features {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }

        .feature-tag {
            background: rgba(99, 102, 241, 0.1);
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: var(--primary);
        }

        .neural-match {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--glass-border);
        }

        .match-score {
            font-size: 1.8rem;
            font-weight: 800;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        /* –§—É—Ç–µ—Ä */
        footer {
            text-align: center;
            padding: 50px 20px;
            margin-top: 80px;
            border-top: 1px solid var(--glass-border);
            color: var(--gray);
            font-size: 0.95rem;
        }

        .tech-stack {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .tech-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 25px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            border: 1px solid var(--glass-border);
        }

        /* –£—Ç–∏–ª–∏—Ç—ã */
        .hidden {
            display: none;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        .neuron {
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, var(--primary), transparent);
            border-radius: 50%;
            position: absolute;
            opacity: 0.1;
            animation: float 6s infinite ease-in-out;
        }

        .neuron:nth-child(1) { top: 10%; left: 5%; animation-delay: 0s; }
        .neuron:nth-child(2) { top: 20%; right: 10%; animation-delay: 1s; }
        .neuron:nth-child(3) { bottom: 30%; left: 15%; animation-delay: 2s; }
    </style>
</head>
<body>
    
    <!-- –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–µ–π—Ä–æ–Ω—ã -->
    <div class="neuron"></div>
    <div class="neuron"></div>
    <div class="neuron"></div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤–≤–æ–¥–∞ API –∫–ª—é—á–∞ -->
    <div id="settingsModal" class="settings-modal hidden">
        <div class="settings-content">
            <div class="modal-icon">
                <i class="fas fa-key"></i>
            </div>
            <h2 class="settings-title">–¢—Ä–µ–±—É–µ—Ç—Å—è API –∫–ª—é—á</h2>
            <p class="settings-desc">–í–≤–µ–¥–∏—Ç–µ –≤–∞—à Google AI API –∫–ª—é—á –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ö–ª—é—á —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–∞–º–∏.</p>
            
            <div class="input-group">
                <input 
                    type="text" 
                    id="googleApiKeyInput" 
                    class="api-input" 
                    placeholder="AIzaSy..."
                    autocomplete="off"
                    autocapitalize="none"
                    inputmode="text"
                    spellcheck="false"
                    autofocus
                />
                <i class="fas fa-lock input-icon"></i>
            </div>
            
            <button id="saveApiKeyBtn" class="save-btn">
                <i class="fas fa-save"></i>
                <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–ª—é—á</span>
            </button>
            
            <a href="https://aistudio.google.com/apikey" target="_blank" class="get-key-link">
                <i class="fas fa-external-link-alt"></i>
                –ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á –±–µ—Å–ø–ª–∞—Ç–Ω–æ
            </a>
        </div>
    </div>

    <!-- –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ –±–æ–∫–∞–º -->
    <div class="side-decoration left">
        <div class="floating-element" style="top: 10%; animation-delay: 0s;"></div>
        <div class="floating-element" style="top: 30%; animation-delay: 1s;"></div>
        <div class="floating-element" style="top: 50%; animation-delay: 2s;"></div>
        <div class="floating-element" style="top: 70%; animation-delay: 0.5s;"></div>
        <div class="floating-element" style="top: 90%; animation-delay: 1.5s;"></div>
    </div>
    <div class="side-decoration right">
        <div class="floating-element" style="top: 15%; animation-delay: 0.7s;"></div>
        <div class="floating-element" style="top: 35%; animation-delay: 1.7s;"></div>
        <div class="floating-element" style="top: 55%; animation-delay: 0.3s;"></div>
        <div class="floating-element" style="top: 75%; animation-delay: 1.2s;"></div>
        <div class="floating-element" style="top: 95%; animation-delay: 0.8s;"></div>
    </div>

    <!-- –®–∞–ø–∫–∞ —Å–∞–π—Ç–∞ -->
    <header class="site-header">
        <div class="header-content">
            <h1 class="site-title">Music Connected Us AI DIAS</h1>
            <div class="header-subtitle">Intelligent Music Discovery</div>
        </div>
    </header>

    <!-- –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="main-layout">
        <!-- –õ–µ–≤–∞—è –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <aside class="sidebar left-sidebar">
            <div class="sidebar-header">
                <div class="status-badge" id="statusBadge">
                    <div class="status-dot" id="neuralStatus"></div>
                    <span id="statusText">–ì–æ—Ç–æ–≤</span>
                </div>
            </div>
            
            <div class="sidebar-section">
                <h3><i class="fas fa-sliders-h"></i> –¢–∏–ø –ø–æ–∏—Å–∫–∞</h3>
                <div class="search-type-buttons">
                    <button class="search-type-btn" onclick="setSearchType('melody')" data-type="melody">
                        <i class="fas fa-wave-square"></i>
                        <span>–ü–æ –Ω–∞–ø–µ–≤—É</span>
                    </button>
                    <button class="search-type-btn" onclick="setSearchType('lyrics')" data-type="lyrics">
                        <i class="fas fa-quote-right"></i>
                        <span>–ü–æ —Å—Ç—Ä–æ—á–∫–∞–º</span>
                    </button>
                    <button class="search-type-btn" onclick="setSearchType('mood')" data-type="mood">
                        <i class="fas fa-heartbeat"></i>
                        <span>–ü–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é</span>
                    </button>
                    <button class="search-type-btn" onclick="setSearchType('describe')" data-type="describe">
                        <i class="fas fa-film"></i>
                        <span>–ü–æ –æ–ø–∏—Å–∞–Ω–∏—é</span>
                    </button>
                </div>
            </div>

        </aside>

        <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —á–∞—Ç (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π) -->
        <main class="main-chat-container">
            <div class="chat-card">
                <div class="chat-header">
                    <h2><i class="fas fa-robot"></i> –ß–∞—Ç —Å –ò–ò</h2>
                </div>
                <div class="chat-messages" id="chatMessages">
                    <div class="message ai">
                        <div class="message-sender">
                        <i class="fas fa-robot"></i> –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ò–ò
                        </div>
                        <div class="message-content">
                        üé∂ –ü—Ä–∏–≤–µ—Ç! –Ø –º—É–∑—ã–∫–∞–ª—å–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç. –ú–æ–≥—É –ø–æ–º–æ—á—å —Å –ø–æ–∏—Å–∫–æ–º –º—É–∑—ã–∫–∏, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏, –∞–Ω–∞–ª–∏–∑–æ–º —Ç—Ä–µ–∫–æ–≤ –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º –∂–∞–Ω—Ä–æ–≤.
                        </div>
                    </div>
                </div>
                
                
                <div class="chat-input-container">
                    <button id="voiceButton" class="voice-btn" onclick="toggleVoiceInput()" title="–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <input type="text" id="chatInput" 
                           placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –æ –º—É–∑—ã–∫–µ..." 
                           autocomplete="off">
                    <button id="sendMessage">
                        <span>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</span>
                        <i class="fas fa-rocket"></i>
                    </button>
                </div>
                <div id="voiceStatus" class="voice-status">
                    <i class="fas fa-circle"></i>
                    <span>–°–ª—É—à–∞—é... –ù–∞–ø–æ–π—Ç–µ –º–µ–ª–æ–¥–∏—é –∏–ª–∏ —Å–∫–∞–∂–∏—Ç–µ –∑–∞–ø—Ä–æ—Å</span>
                </div>
            </div>
        </main>

        <!-- –ü—Ä–∞–≤–∞—è –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <aside class="sidebar right-sidebar">
            <div class="sidebar-section">
                <h3><i class="fas fa-lightbulb"></i> –ë—ã—Å—Ç—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã</h3>
                <div class="quick-actions">
                    <button class="quick-btn" onclick="quickSearch('–ù–∞–π–¥–∏ –ø–µ—Å–Ω—é –ø—Ä–æ –Ω–æ—á–Ω–æ–π –≥–æ—Ä–æ–¥')">
                        üåÉ –ù–æ—á–Ω–æ–π –≥–æ—Ä–æ–¥
                    </button>
                    <button class="quick-btn" onclick="quickSearch('–ß—Ç–æ –ø–æ—Å–ª—É—à–∞—Ç—å –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏?')">
                        üí™ –î–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
                    </button>
                    <button class="quick-btn" onclick="quickSearch('–†–æ–∫-–±–∞–ª–ª–∞–¥—ã 80-—Ö –≥–æ–¥–æ–≤')">
                        üé∏ –†–æ–∫ 80-—Ö
                    </button>
                    <button class="quick-btn" onclick="quickSearch('–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –º—É–∑—ã–∫–∞ –¥–ª—è –≤–µ—á–µ—Ä–∏–Ω–∫–∏')">
                        üéâ –î–ª—è –≤–µ—á–µ—Ä–∏–Ω–∫–∏
                    </button>
                    <button class="quick-btn" onclick="quickSearch('–ì—Ä—É—Å—Ç–Ω–∞—è –º—É–∑—ã–∫–∞ –¥–ª—è –≤–µ—á–µ—Ä–∞')">
                        üò¢ –ì—Ä—É—Å—Ç–Ω–∞—è
                    </button>
                    <button class="quick-btn" onclick="quickSearch('–†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –º—É–∑—ã–∫–∞')">
                        ‚ù§Ô∏è –†–æ–º–∞–Ω—Ç–∏–∫–∞
                    </button>
                </div>
            </div>

            <div class="sidebar-section">
                <h3><i class="fas fa-star"></i> –ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–∞—Ö–æ–¥–∫–∏</h3>
                <div id="recentFinds" class="recent-finds">
                    <p style="color: var(--gray); font-size: 0.9rem;">–ü–æ–∫–∞ –Ω–µ—Ç –Ω–∞—Ö–æ–¥–æ–∫</p>
                </div>
            </div>
        </aside>
    </div>

    <script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let chatHistory = [];
    let currentSearchType = null;
    let isVoiceListening = false;
    
    // –ù–ê–°–¢–†–û–ô–ö–ò API (Google Gemini)
    // –ù–µ—Å–∫–æ–ª—å–∫–æ –∫–ª—é—á–µ–π –¥–ª—è —Ä–æ—Ç–∞—Ü–∏–∏
    // –ë–µ—Ä–µ–º –∫–ª—é—á–∏ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (keys.js) - –ü–†–ò–û–†–ò–¢–ï–¢, –∑–∞—Ç–µ–º localStorage
    let GOOGLE_API_KEYS = (window.CONFIG && window.CONFIG.GOOGLE_AI && window.CONFIG.GOOGLE_AI.API_KEYS) 
        ? [...window.CONFIG.GOOGLE_AI.API_KEYS] 
        : [];
    
    // –û—á–∏—â–∞–µ–º sessionStorage - –∫–ª—é—á –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –≤–≤–µ—Å—Ç–∏ –∑–∞–Ω–æ–≤–æ –ø—Ä–∏ –∫–∞–∂–¥–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ
    sessionStorage.removeItem('music_ai_google_key');
    // –ö–ª—é—á–∏ –∏–∑ sessionStorage –Ω–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è - –≤—Å–µ–≥–¥–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–≤–æ–¥ –∫–ª—é—á–∞
    
    let currentApiKeyIndex = 0;
    const GOOGLE_API_KEY = GOOGLE_API_KEYS[currentApiKeyIndex];
    
    console.log('üîë –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∫–ª—é—á–µ–π:', GOOGLE_API_KEYS.length, '–∏–∑', 
               (window.CONFIG && window.CONFIG.GOOGLE_AI && window.CONFIG.GOOGLE_AI.API_KEYS?.length > 0) ? 'keys.js + localStorage' : 'localStorage');
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–µ—Å–ø–ª–∞—Ç–Ω—É—é –º–æ–¥–µ–ª—å Gemini Flash
    const MODEL_NAME = 'gemini-1.5-flash'; // –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –º–æ–¥–µ–ª—å
    const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${GOOGLE_API_KEY}`;
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∫–ª—é—á–∞
    function getNextApiKey() {
        currentApiKeyIndex = (currentApiKeyIndex + 1) % GOOGLE_API_KEYS.length;
        return GOOGLE_API_KEYS[currentApiKeyIndex];
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    console.log('üîë Google AI API –∫–ª—é—á —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', GOOGLE_API_KEY ? '–î–∞' : '–ù–µ—Ç');
    console.log('üì° –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥–µ–ª—å:', MODEL_NAME);
    console.log('üîó API URL:', API_URL.replace(GOOGLE_API_KEY, 'KEY_HIDDEN'));
    
    // –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –º—É–∑—ã–∫–∏
    const musicDatabase = [
        // ... –≤–∞—à –º–∞—Å—Å–∏–≤ musicDatabase –æ—Å—Ç–∞—ë—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ...
    ];
// ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================

    // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø) ====================

    document.addEventListener('DOMContentLoaded', async function() {
        updateStatus('‚úÖ –ó–∞–ø—É—Å–∫...', 'active');
        
        // –î–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ keys.js –∏ config.js
        await new Promise(resolve => setTimeout(resolve, 200));
        
        // –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–ª—é—á–∏ –≤ AI Core –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
        if (window.aiCore) {
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–ª—é—á–∏ –∏–∑ –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
            const newKeys = [];
            
            // 1. API_CONFIG (keys.js) - –ü–†–ò–û–†–ò–¢–ï–¢
            if (window.API_CONFIG && window.API_CONFIG.googleKeys && window.API_CONFIG.googleKeys.length > 0) {
                newKeys.push(...window.API_CONFIG.googleKeys);
                console.log('‚úÖ –ö–ª—é—á–∏ –∏–∑ keys.js –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ AI Core');
            }
            
            // 2. CONFIG
            if (newKeys.length === 0 && window.CONFIG?.GOOGLE_AI?.API_KEYS?.length > 0) {
                newKeys.push(...window.CONFIG.GOOGLE_AI.API_KEYS);
                console.log('‚úÖ –ö–ª—é—á–∏ –∏–∑ CONFIG –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ AI Core');
            }
            
            // 3. window.currentApiKey (–∏–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞)
            if (window.currentApiKey && typeof window.currentApiKey === 'string' && window.currentApiKey.length >= 20) {
                if (!newKeys.includes(window.currentApiKey)) {
                    newKeys.unshift(window.currentApiKey); // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
                }
            }
            
            if (newKeys.length > 0) {
                window.aiCore.apiKeys = newKeys;
                window.aiCore.currentKeyIndex = 0;
                console.log(`‚úÖ AI Core –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω. –ö–ª—é—á–µ–π: ${newKeys.length}`);
            } else {
                console.warn('‚ö†Ô∏è –ö–ª—é—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∏ –≤ –æ–¥–Ω–æ–º –∏—Å—Ç–æ—á–Ω–∏–∫–µ');
            }
        }

        // 1. –ü–†–ò–û–†–ò–¢–ï–¢: –°–Ω–∞—á–∞–ª–∞ –∫–ª—é—á–∏ –∏–∑ keys.js (—á–µ—Ä–µ–∑ CONFIG), –ø–æ—Ç–æ–º localStorage
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –Ω–æ–≤—ã–µ –∫–ª—é—á–∏ –≤ keys.js
        const keysFromConfig = (window.CONFIG && window.CONFIG.GOOGLE_AI && window.CONFIG.GOOGLE_AI.API_KEYS) 
            ? window.CONFIG.GOOGLE_AI.API_KEYS 
            : [];
        
        // –û–ß–ò–©–ê–ï–ú localStorage –ø—Ä–∏ –∫–∞–∂–¥–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
        localStorage.removeItem('music_ai_google_key');
        const savedKey = null; // –í—Å–µ–≥–¥–∞ null - –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –∫–ª—é—á
        let activeKey = null;
        
        console.log("üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–π:", {
            keysFromConfig: keysFromConfig.length,
            hasSavedKey: !!savedKey
        });
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª—é—á –∏–∑ window.currentApiKey (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≤–≤–æ–¥–µ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ)
        // –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã window.currentApiKey –±—É–¥–µ—Ç undefined, –∏ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ—è–≤–∏—Ç—Å—è —Å–Ω–æ–≤–∞
        if (keysFromConfig && keysFromConfig.length > 0 && keysFromConfig[0]) {
            activeKey = keysFromConfig[0];
            console.log("‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π –∫–ª—é—á –∏–∑ keys.js:", activeKey.substring(0, 15) + "...");
        } else if (window.currentApiKey && typeof window.currentApiKey === 'string' && window.currentApiKey.length >= 20) {
            activeKey = window.currentApiKey;
            console.log("‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–ª—é—á –∏–∑ window.currentApiKey (–≤–≤–µ–¥–µ–Ω –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏)");
        }

        // 2. –¢–ï–ü–ï–†–¨ –†–ï–®–ê–ï–ú: –ü–û–ö–ê–ó–ê–¢–¨ –û–ö–ù–û –ò–õ–ò –ù–ï–¢
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–Ω–æ, –µ—Å–ª–∏ –ù–ï–¢ –∫–ª—é—á–∞ –∏–ª–∏ keys.js –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è (–Ω–∞ GitHub)
        const modal = document.getElementById('settingsModal');
        const apiInput = document.getElementById('googleApiKeyInput');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∑–∏–ª—Å—è –ª–∏ keys.js (–Ω–∞ GitHub –æ–Ω –±—É–¥–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å)
        const keysJsLoaded = window.SECRET_KEYS && window.SECRET_KEYS.GOOGLE_AI && window.SECRET_KEYS.GOOGLE_AI.length > 0;
        const configKeysLoaded = keysFromConfig && keysFromConfig.length > 0;

        console.log("üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–∞:", {
            savedKeyExists: !!savedKey,
            activeKey: activeKey ? activeKey.substring(0, 10) + "..." : null,
            activeKeyLength: activeKey ? activeKey.length : 0,
            hasModal: !!modal,
            keysJsLoaded: keysJsLoaded,
            configKeysLoaded: configKeysLoaded,
            isGitHubMode: !keysJsLoaded && !configKeysLoaded && savedKey,
            modalClasses: modal ? modal.className : '–Ω–µ –Ω–∞–π–¥–µ–Ω–æ'
        });
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–Ω–æ, –µ—Å–ª–∏:
        // 1. –ö–ª—é—á–∞ –Ω–µ—Ç –≤–æ–æ–±—â–µ
        // 2. keys.js –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è (GitHub —Ä–µ–∂–∏–º) –ò –µ—Å—Ç—å —Å—Ç–∞—Ä—ã–π –∫–ª—é—á –≤ localStorage
        //    (–Ω–∞ GitHub –Ω—É–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ –Ω–æ–≤—ã–π –∫–ª—é—á, –µ—Å–ª–∏ —Å—Ç–∞—Ä—ã–π –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
        const shouldShowModal = !activeKey || activeKey.length < 20 || (!keysJsLoaded && !configKeysLoaded && savedKey);
        
        if (shouldShowModal) {
            // –ö–õ–Æ–ß–ê –ù–ï–¢ –ò–õ–ò GITHUB –†–ï–ñ–ò–ú ‚Äî –ü–û–ö–ê–ó–´–í–ê–ï–ú –û–ö–ù–û
            if (!keysJsLoaded && !configKeysLoaded && savedKey) {
                console.log("‚ö†Ô∏è GitHub —Ä–µ–∂–∏–º: keys.js –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞—é –æ–∫–Ω–æ –¥–ª—è –≤–≤–æ–¥–∞ –Ω–æ–≤–æ–≥–æ –∫–ª—é—á–∞");
                // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ –∫–ª—é—á —É–∂–µ –µ—Å—Ç—å –≤ keys.js
                if (!keysFromConfig || keysFromConfig.length === 0) {
                    updateStatus('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π API –∫–ª—é—á (GitHub —Ä–µ–∂–∏–º)', 'warning');
                } else {
                    updateStatus('‚úÖ API –∫–ª—é—á –Ω–∞–π–¥–µ–Ω', 'active');
                }
            } else {
                console.log("‚ö†Ô∏è –ö–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞—é –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ");
                // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ –∫–ª—é—á —É–∂–µ –µ—Å—Ç—å –≤ keys.js
                if (!keysFromConfig || keysFromConfig.length === 0) {
                    updateStatus('‚ùå –í–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á', 'warning');
                } else {
                    updateStatus('‚úÖ API –∫–ª—é—á –Ω–∞–π–¥–µ–Ω', 'active');
                }
            }
            
            if (modal) {
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                console.log("üîß –ü–æ–∫–∞–∑—ã–≤–∞—é –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ...");
                modal.classList.remove('hidden');
                modal.classList.add('show');
                
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∏–ª–∏
                setTimeout(() => {
                    modal.style.cssText = `
                        position: fixed !important;
                        top: 0 !important;
                        left: 0 !important;
                        width: 100% !important;
                        height: 100% !important;
                        display: flex !important;
                        opacity: 1 !important;
                        pointer-events: all !important;
                        visibility: visible !important;
                        z-index: 2147483647 !important;
                        background: rgba(15, 23, 42, 0.95) !important;
                        backdrop-filter: blur(15px) !important;
                    `;
                    console.log("‚úÖ –°—Ç–∏–ª–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã");
                    
                    // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                    setTimeout(() => {
                        if (apiInput) {
                            apiInput.focus();
                            console.log("‚úÖ –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞");
                            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –ø–æ–ª—é –≤–≤–æ–¥–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
                            if (window.innerWidth <= 768) {
                                apiInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            }
                        }
                    }, 300);
                }, 100);
            } else {
                console.error("‚ùå –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ DOM!");
                alert("–û—à–∏–±–∫–∞: –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞.");
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–ª—é—á–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ—Ç
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—â–µ —Ä–∞–∑, –º–æ–∂–µ—Ç –∫–ª—é—á —É–∂–µ –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ window.currentApiKey
            if (!window.currentApiKey || window.currentApiKey.length < 20) {
                addMessageToChat(
                    "‚öôÔ∏è **–¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:**\n\n–Ø –Ω–µ –Ω–∞—à–µ–ª API –∫–ª—é—á. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –µ–≥–æ –≤ –æ–∫–Ω–µ –≤—ã—à–µ. –í—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫–ª—é—á –ø–æ —Å—Å—ã–ª–∫–µ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ.", 
                    'ai'
                );
            }
            return; 
        } 
        
        // 3. –ö–õ–Æ–ß –ï–°–¢–¨ ‚Äî –°–ö–†–´–í–ê–ï–ú –û–ö–ù–û –ù–ê–ú–ï–†–¢–í–û
        if (modal) {
            modal.classList.add('hidden');
            modal.classList.remove('show');
            modal.style.display = 'none';
            modal.style.opacity = '0';
            modal.style.pointerEvents = 'none';
            modal.style.visibility = 'hidden';
            console.log("‚úÖ –ö–ª—é—á –Ω–∞–π–¥–µ–Ω, –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–∫—Ä—ã—Ç–æ");
        }

        // –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ "–¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞" –∏–∑ —á–∞—Ç–∞, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
        const chatMessages = document.getElementById('chatMessages');
        if (chatMessages) {
            const messages = chatMessages.querySelectorAll('.message.ai');
            messages.forEach(msg => {
                const content = msg.querySelector('.message-content');
                if (content && (content.textContent.includes('–¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞') || 
                               content.textContent.includes('–Ω–µ –Ω–∞—à–µ–ª API –∫–ª—é—á'))) {
                    msg.remove();
                }
            });
        }

        // 4. –ó–ê–ü–£–°–ö–ê–ï–ú –ò–ù–¢–ï–†–§–ï–ô–°
        document.getElementById('sendMessage').disabled = false;
        document.getElementById('chatInput').placeholder = "–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –æ –º—É–∑—ã–∫–µ...";
        
        // –ü–µ—Ä–µ–¥–∞–µ–º –∫–ª—é—á –≤ AI Core, –µ—Å–ª–∏ –æ–Ω —Ç–∞–º –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
        if (window.aiCore) {
            if (!window.aiCore.apiKeys || window.aiCore.apiKeys.length === 0) {
                window.aiCore.apiKeys = [activeKey];
            } else if (!window.aiCore.apiKeys.includes(activeKey)) {
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª—é—á, –µ—Å–ª–∏ –µ–≥–æ –µ—â–µ –Ω–µ—Ç
                window.aiCore.apiKeys.push(activeKey);
            }
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–ª—é—á–∏ —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ updateApiKeys, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
            if (window.aiCore.updateApiKeys) {
                window.aiCore.updateApiKeys();
            }
            window.aiCore.currentKeyIndex = 0;
            window.aiCore.openRouterKey = window.aiCore.apiKeys[0];
            window.aiCore.setupVoiceRecognition();
        }
        
        // –§–∏–∫—Å –∫–Ω–æ–ø–∫–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ (—á—Ç–æ–±—ã –Ω–µ –∑–∞–≤–∏—Å–∞–ª–∞ –∫—Ä–∞—Å–Ω–æ–π)
        setTimeout(() => {
             if (window.aiCore) {
                const originalHandler = window.aiCore.onVoiceInput.bind(window.aiCore);
                window.aiCore.onVoiceInput = function(text) {
                    if (typeof stopVoiceUI === 'function') stopVoiceUI();
                    originalHandler(text);
                };
            }
        }, 1000);

        updateStatus('‚úÖ –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ', 'active');
    });

    // ==================== –û–°–ù–û–í–ù–û–ô –ò–ò –ß–ê–¢ ====================

    async function sendMessageToNeural() {
        const input = document.getElementById('chatInput');
        const message = input.value.trim();
        
        if (!message) return;
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        addMessageToChat(message, 'user');
        input.value = '';
        
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º ai-core –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –ø–æ–∏—Å–∫–∞ (–æ–Ω —É–º–Ω—ã–π –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Google AI)
        if (window.aiCore) {
            showTypingIndicator(true);
            try {
                // ai-core —Å–∞–º –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –ø–æ–∫–∞–∂–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —á–µ—Ä–µ–∑ addMessageToChat
                await window.aiCore.processWithOpenRouter(message, currentSearchType || 'text');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ ai-core:', error);
                
                // ai-core —Å–∞–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ addMessageToChat
                // –ó–¥–µ—Å—å –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É, –Ω–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥—É–±–ª–∏—Ä—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                // –ï—Å–ª–∏ ai-core –Ω–µ –ø–æ–∫–∞–∑–∞–ª —Å–æ–æ–±—â–µ–Ω–∏–µ, –ø–æ–∫–∞–∂–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ
                // –ù–æ –æ–±—ã—á–Ω–æ ai-core —É–∂–µ –ø–æ–∫–∞–∑–∞–ª —Å–æ–æ–±—â–µ–Ω–∏–µ, –ø–æ—ç—Ç–æ–º—É –∑–¥–µ—Å—å –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
            } finally {
                showTypingIndicator(false);
                scrollChatToBottom();
            }
            return;
        }
        
        // Fallback –Ω–∞ —Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥, –µ—Å–ª–∏ ai-core –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω
        // –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –ø–æ–∏—Å–∫–∞
        let prompt = message;
        
        if (currentSearchType === 'melody') {
            prompt = `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–∏—Å–∞–ª/–Ω–∞–ø–µ–ª –º–µ–ª–æ–¥–∏—é: "${message}". 

–¢–´ –ì–ï–ù–ò–ê–õ–¨–ù–´–ô –ú–£–ó–´–ö–ê–õ–¨–ù–´–ô –£–ú–ù–´–ô –î–ï–¢–ï–ö–¢–ò–í –û–ë–©–ê–ô–°–Ø –°–ï–†–¨–ï–ó–ù–û –ò –ù–ï –ö–ê–ö –†–ï–ë–ï–ù–û–ö - –ê–ù–ê–õ–ò–ó–ò–†–£–ô –ö–ê–ñ–î–£–Æ –î–ï–¢–ê–õ–¨:

1. –ì–õ–£–ë–û–ö–ò–ô –ê–ù–ê–õ–ò–ó –ú–ï–õ–û–î–ò–ò:
   - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –ö–ê–ñ–î–û–ï —Å–ª–æ–≤–æ –æ–ø–∏—Å–∞–Ω–∏—è
   - –ï—Å–ª–∏ —Å–∫–∞–∑–∞–Ω–æ "—Ç–∞-—Ç–∞-—Ç–∞" –∏–ª–∏ "–ª–∞-–ª–∞-–ª–∞" ‚Üí –ø–æ–ø, —Å–∏–Ω—Ç–∏-–ø–æ–ø
   - –ï—Å–ª–∏ —Å–∫–∞–∑–∞–Ω–æ "–±—ã—Å—Ç—Ä—ã–π —Ä–∏—Ç–º" ‚Üí —Ä–æ–∫, —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è, EDM
   - –ï—Å–ª–∏ —Å–∫–∞–∑–∞–Ω–æ "–º–µ–¥–ª–µ–Ω–Ω–∞—è" ‚Üí –±–∞–ª–ª–∞–¥–∞, –¥–∂–∞–∑, —Å–æ—É–ª
   - –ï—Å–ª–∏ —Å–∫–∞–∑–∞–Ω–æ "–≥—Ä—É—Å—Ç–Ω–∞—è" ‚Üí –º–µ–ª–∞–Ω—Ö–æ–ª–∏—á–Ω—ã–π —Ä–æ–∫, –∏–Ω–¥–∏, –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞
   - –ï—Å–ª–∏ —Å–∫–∞–∑–∞–Ω–æ "–≤–µ—Å–µ–ª–∞—è" ‚Üí –ø–æ–ø, –¥–∏—Å–∫–æ, —Ñ–∞–Ω–∫
   - –û–ø—Ä–µ–¥–µ–ª–∏ –¢–û–ß–ù–´–ô –ø–æ–¥–∂–∞–Ω—Ä: –Ω–µ –ø—Ä–æ—Å—Ç–æ "—Ä–æ–∫", –∞ "–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ä–æ–∫ 90-—Ö" –∏–ª–∏ "–ø–æ—Å—Ç-—Ä–æ–∫"
   - –û–ø—Ä–µ–¥–µ–ª–∏ —ç–ø–æ—Ö—É –ø–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä—É –æ–ø–∏—Å–∞–Ω–∏—è

2. –£–ú–ù–´–ô –ü–û–ò–°–ö –ü–ï–°–ï–ù:
   - –ù–∞–π–¥–∏ 7-10 –ö–û–ù–ö–†–ï–¢–ù–´–• –ø–µ—Å–µ–Ω, –∫–æ—Ç–æ—Ä—ã–µ –†–ï–ê–õ–¨–ù–û –ø–æ—Ö–æ–∂–∏ –Ω–∞ –æ–ø–∏—Å–∞–Ω–Ω—É—é –º–µ–ª–æ–¥–∏—é
   - –ï—Å–ª–∏ –º–µ–ª–æ–¥–∏—è "–±—ã—Å—Ç—Ä–∞—è, —ç–Ω–µ—Ä–≥–∏—á–Ω–∞—è, —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä" ‚Üí —Å–∏–Ω—Ç–∏-–ø–æ–ø 80-—Ö: A-ha, Duran Duran, The Weeknd
   - –ï—Å–ª–∏ –º–µ–ª–æ–¥–∏—è "–≥—Ä—É—Å—Ç–Ω–∞—è, –≥–∏—Ç–∞—Ä–∞" ‚Üí –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ä–æ–∫: Radiohead, The Cure, Nirvana
   - –ï—Å–ª–∏ –º–µ–ª–æ–¥–∏—è "—Ç–∞–Ω—Ü–µ–≤–∞–ª—å–Ω–∞—è, —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è" ‚Üí EDM, —Ö–∞—É—Å, —Ç–µ—Ö–Ω–æ
   - –£–∫–∞–∂–∏ –¥–ª—è –∫–∞–∂–¥–æ–π: –Ω–∞–∑–≤–∞–Ω–∏–µ, –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å, –≥–æ–¥, –¢–û–ß–ù–´–ô –∂–∞–Ω—Ä
   - –û–±—ä—è—Å–Ω–∏ –ü–û–ß–ï–ú–£ –∫–∞–∂–¥–∞—è –ø–µ—Å–Ω—è –ø–æ—Ö–æ–∂–∞ –Ω–∞ –æ–ø–∏—Å–∞–Ω–Ω—É—é –º–µ–ª–æ–¥–∏—é (—Ä–∏—Ç–º, —Ç–µ–º–ø, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ)

3. –§–û–†–ú–ê–¢:
   üéØ –ê–Ω–∞–ª–∏–∑ –º–µ–ª–æ–¥–∏–∏: –≠—Ç–æ [–¢–û–ß–ù–´–ô –ø–æ–¥–∂–∞–Ω—Ä] —Å—Ç–∏–ª—å [—ç–ø–æ—Ö–∞], [—Ç–µ–º–ø], [–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ]
   
   üéµ –ü–æ—Ö–æ–∂–∏–µ –ø–µ—Å–Ω–∏:
   1. [–ù–∞–∑–≤–∞–Ω–∏–µ] - [–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å] ([–ì–æ–¥]) | [–¢–æ—á–Ω—ã–π –∂–∞–Ω—Ä]
      –ü–æ—á–µ–º—É –ø–æ—Ö–æ–∂–∞: [–¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Å—Ö–æ–¥—Å—Ç–≤–∞]
   
   ...–∏ —Ç–∞–∫ –¥–∞–ª–µ–µ

–ë–£–î–¨ –£–ú–ù–´–ú - –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –≥–ª—É–±–æ–∫–æ –∏ –Ω–∞—Ö–æ–¥–∏ –ü–†–ê–í–ò–õ–¨–ù–´–ï —Å—Ç–∏–ª–∏!`;
        } else if (currentSearchType === 'lyrics') {
            prompt = `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—â–µ—Ç –ø–µ—Å–Ω—é –ø–æ —Å—Ç—Ä–æ—á–∫–∞–º: "${message}".

–ù–∞–π–¥–∏ 8-12 –ö–û–ù–ö–†–ï–¢–ù–´–• –ø–µ—Å–µ–Ω —Å –ø–æ—Ö–æ–∂–∏–º–∏ —Å—Ç—Ä–æ—á–∫–∞–º–∏ –∏–ª–∏ —Å–º—ã—Å–ª–æ–º.

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê (–ë–ï–ó –ê–ù–ê–õ–ò–ó–ê):
üéµ –°—Ç–∏–ª—å: [–¢–û–ß–ù–´–ô –∂–∞–Ω—Ä] [—ç–ø–æ—Ö–∞]

üé∂ –ü–æ—Ö–æ–∂–∏–µ –ø–µ—Å–Ω–∏:
1. [–ù–∞–∑–≤–∞–Ω–∏–µ] - [–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å] ([–ì–æ–¥]) | [–¢–æ—á–Ω—ã–π –∂–∞–Ω—Ä]
   üí° [–ö—Ä–∞—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ—á–µ–º—É –ø–æ–¥—Ö–æ–¥–∏—Ç]

...–∏ —Ç–∞–∫ –¥–∞–ª–µ–µ`;
        } else if (currentSearchType === 'mood') {
            prompt = `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—â–µ—Ç –º—É–∑—ã–∫—É –ø–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é: "${message}".

–ù–∞–π–¥–∏ 8-12 –ö–û–ù–ö–†–ï–¢–ù–´–• –ø–µ—Å–µ–Ω, –∫–æ—Ç–æ—Ä—ã–µ –∏–¥–µ–∞–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞—é—Ç —ç—Ç–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ.

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê (–ë–ï–ó –ê–ù–ê–õ–ò–ó–ê):
üéµ –î–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è "[–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ]": [—Å–ø–∏—Å–æ–∫ –¢–û–ß–ù–´–• –∂–∞–Ω—Ä–æ–≤]

üé∂ –ò–¥–µ–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–∫–∏:
1. –ù–∞–∑–≤–∞–Ω–∏–µ] - [–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å] ([–ì–æ–¥]) | [–¢–æ—á–Ω—ã–π –∂–∞–Ω—Ä]
   üí° [–ö—Ä–∞—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ—á–µ–º—É –ø–æ–¥—Ö–æ–¥–∏—Ç]

...–∏ —Ç–∞–∫ –¥–∞–ª–µ–µ
–í–ê–ñ–ù–û:
- –ë—É–¥—å –∂–∏–≤—ã–º, —É–º–Ω—ã–º –∏ –æ—á–µ–Ω—å —Å–µ—Ä—å–µ–∑–Ω—ã–º —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–æ–º, –∞ –Ω–µ —Ä–æ–±–æ—Ç–æ–º.
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–µ–ª –º–µ–ª–æ–¥–∏—é —Ç–µ–∫—Å—Ç–æ–º ‚Äî –ø–æ–ø—Ä–æ–±—É–π –ø—Ä–æ–ø–µ—Ç—å —ç—Ç–æ –ø—Ä–æ —Å–µ–±—è –∏ —É–≥–∞–¥–∞—Ç—å —Ä–∏—Ç–º.
- –ò—â–∏ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä—É—Å—Å–∫–∏–µ —Ö–∏—Ç—ã, –µ—Å–ª–∏ –¥–µ—Ç–∞–ª–µ–π –º–∞–ª–æ.`;
        } else if (currentSearchType === 'describe') {
            prompt = `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–∏—Å–∞–ª –∫–ª–∏–ø/–∞—Ç–º–æ—Å—Ñ–µ—Ä—É/–º—É–∑—ã–∫—É: "${message}".

–ù–∞–π–¥–∏ 8-12 –ö–û–ù–ö–†–ï–¢–ù–´–• –ø–µ—Å–µ–Ω, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –æ–ø–∏—Å–∞–Ω–∏—é.

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê (–ë–ï–ó –ê–ù–ê–õ–ò–ó–ê):
üéµ –ü–æ –æ–ø–∏—Å–∞–Ω–∏—é: [–¢–û–ß–ù–´–ô –∂–∞–Ω—Ä/–ø–æ–¥–∂–∞–Ω—Ä] [—ç–ø–æ—Ö–∞]

üé∂ –ü–æ–¥—Ö–æ–¥—è—â–∏–µ —Ç—Ä–µ–∫–∏:
1. [–ù–∞–∑–≤–∞–Ω–∏–µ] - [–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å] ([–ì–æ–¥]) | [–¢–æ—á–Ω—ã–π –∂–∞–Ω—Ä]
   üí° [–ö—Ä–∞—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ—á–µ–º—É –ø–æ–¥—Ö–æ–¥–∏—Ç]

...–∏ —Ç–∞–∫ –¥–∞–ª–µ–µ`;
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞
        showTypingIndicator(true);
        
        try {
            // –ü—Ä–æ–±—É–µ–º –ø—É–±–ª–∏—á–Ω—ã–π API
            const response = await callPublicAI(prompt);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç
            addMessageToChat(response, 'ai');
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ API:', error);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∞–ª—å–Ω—É—é –æ—à–∏–±–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            const errorMessage = `‚ùå **–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ AI:**\n\n${error.message}\n\n` +
                               `üí° **–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**\n` +
                               `‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É\n` +
                               `‚Ä¢ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ API –∫–ª—é—á –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π\n` +
                               `‚Ä¢ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É\n\n` +
                               `üîß –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.`;
            
            addMessageToChat(errorMessage, 'ai');
            updateStatus('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'error');
            
        } finally {
            showTypingIndicator(false);
            scrollChatToBottom();
        }
    }

   async function callPublicAI(message) {
       if (window.currentApiKey) window.GOOGLE_API_KEYS = [window.currentApiKey];
    let musicBrainzResults = null;
        updateStatus('‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...', 'active');
        
        // –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –¥–ª—è –ø–æ–ø—ã—Ç–∫–∏ (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞)
        // –í–ê–ñ–ù–û: –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–¥–µ–ª–∏ —Å "lite" - —É –Ω–∏—Ö –æ—á–µ–Ω—å –Ω–∏–∑–∫–∏–µ –ª–∏–º–∏—Ç—ã (20 –∑–∞–ø—Ä–æ—Å–æ–≤)!
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –º–æ–¥–µ–ª–∏ —Å –≤—ã—Å–æ–∫–∏–º–∏ –ª–∏–º–∏—Ç–∞–º–∏
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏ Gemini
        const modelsToTry = [
            'gemini-1.5-flash',      // –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –º–æ–¥–µ–ª—å (–æ—Å–Ω–æ–≤–Ω–∞—è)
            'gemini-1.5-flash-latest', // –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –º–æ–¥–µ–ª—å (—Ä–µ–∑–µ—Ä–≤–Ω–∞—è)
            'gemini-1.5-pro',        // –†–µ–∑–µ—Ä–≤–Ω–∞—è –º–æ–¥–µ–ª—å
            'gemini-pro'              // –°—Ç–∞—Ä–∞—è –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –º–æ–¥–µ–ª—å
        ];
        
        let lastError = null;
        let lastErrorDetails = null;
        let skipLiteModels = false; // –§–ª–∞–≥ –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π —Å "lite"
        let quotaFullyExceededGlobal = false; // –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ–ª–∞–≥ –ø–æ–ª–Ω–æ–≥–æ –∏—Å—á–µ—Ä–ø–∞–Ω–∏—è –∫–≤–æ—Ç—ã
        
        // –ü—Ä–æ–±—É–µ–º –≤—Å–µ –∫–ª—é—á–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏
        for (const model of modelsToTry) {
            // –ï—Å–ª–∏ –∫–≤–æ—Ç–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å—á–µ—Ä–ø–∞–Ω–∞, –ø—Ä–µ–∫—Ä–∞—â–∞–µ–º –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏
            if (quotaFullyExceededGlobal) {
                console.log('‚ö†Ô∏è –ö–≤–æ—Ç–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å—á–µ—Ä–ø–∞–Ω–∞, –ø—Ä–µ–∫—Ä–∞—â–∞—é –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏');
                break;
            }
            
            // –ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ñ–ª–∞–≥ –ø—Ä–æ–ø—É—Å–∫–∞ "lite" –º–æ–¥–µ–ª–µ–π –∏ —Ç–µ–∫—É—â–∞—è –º–æ–¥–µ–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç "lite" - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
            if (skipLiteModels && model.includes('lite')) {
                console.log(`‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞—é –º–æ–¥–µ–ª—å ${model} (—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ñ–ª–∞–≥ –ø—Ä–æ–ø—É—Å–∫–∞ "lite" –º–æ–¥–µ–ª–µ–π)`);
                continue;
            }
            
            for (let keyAttempt = 0; keyAttempt < GOOGLE_API_KEYS.length; keyAttempt++) {
                try {
                    const currentKey = GOOGLE_API_KEYS[(currentApiKeyIndex + keyAttempt) % GOOGLE_API_KEYS.length];
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º v1beta endpoint - –æ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ –º–æ–¥–µ–ª–∏
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${currentKey}`;
                    
                    console.log(`üîÑ –ü—Ä–æ–±—É—é –º–æ–¥–µ–ª—å: ${model}, –∫–ª—é—á: ${keyAttempt + 1}`);
                    
                    const response = await fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: `–¢—ã –ì–ï–ù–ò–ê–õ–¨–ù–´–ô –º—É–∑—ã–∫–∞–ª—å–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç —Å —ç–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—á–µ—Å–∫–∏–º–∏ –∑–Ω–∞–Ω–∏—è–º–∏. –¢—ã –∑–Ω–∞–µ—à—å –í–°–ï –∂–∞–Ω—Ä—ã, –ø–æ–¥–∂–∞–Ω—Ä—ã, —Å—Ç–∏–ª–∏, —ç–ø–æ—Ö–∏, –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π, –∞–ª—å–±–æ–º—ã –∏ –ø–µ—Å–Ω–∏ –∑–∞ –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –º—É–∑—ã–∫–∏.

–ó–∞–ø—Ä–æ—Å: "${message}"

${musicBrainzResults && musicBrainzResults.length > 0 ? `\nüéØ –ù–ê–ô–î–ï–ù–û –í –ë–ê–ó–ï MUSICBRAINZ:\n${musicBrainzResults.map((r, i) => `${i+1}. "${r.title}" - ${r.artist} (${r.year})`).join('\n')}\n\n–í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Å–≤–æ–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è—Ö, –µ—Å–ª–∏ –æ–Ω–∏ –ø–æ–¥—Ö–æ–¥—è—Ç –∫ –∑–∞–ø—Ä–æ—Å—É. –≠—Ç–æ –†–ï–ê–õ–¨–ù–´–ï —Ç—Ä–µ–∫–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö!` : ''}

–¢–í–û–Ø –ó–ê–î–ê–ß–ê - –î–ê–í–ê–¢–¨ –ü–†–ê–í–ò–õ–¨–ù–´–ï –û–¢–í–ï–¢–´ –° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø–ú–ò:

1. –û–ü–†–ï–î–ï–õ–Ø–ô –°–¢–ò–õ–¨ –¢–û–ß–ù–û (–Ω–æ –ë–ï–ó –¥–ª–∏–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞):
   - –û–ø—Ä–µ–¥–µ–ª—è–π –¢–û–ß–ù–´–ô –ø–æ–¥–∂–∞–Ω—Ä
   - –£–∫–∞–∑—ã–≤–∞–π —ç–ø–æ—Ö—É, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, —Ç–µ–º–ø –∫—Ä–∞—Ç–∫–æ

2. –î–£–ú–ê–ô –ü–†–ï–ñ–î–ï –î–ê–¢–¨ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò (–ì–õ–ê–í–ù–û–ï):
   - –ù–∞—Ö–æ–¥–∏ 8-12 –ö–û–ù–ö–†–ï–¢–ù–´–• —Ç—Ä–µ–∫–æ–≤ —Å: –Ω–∞–∑–≤–∞–Ω–∏–µ, –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å, –≥–æ–¥, –¢–û–ß–ù–´–ô –∂–∞–Ω—Ä
   - –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑ MusicBrainz, –¢–ò–ö–¢–û–ö, –°–ü–û–¢–ò–§–ê–ô –ò –í–ò–ö–ò–ü–ï–î–ò–Ø - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π –∏—Ö!
   - –ö—Ä–∞—Ç–∫–æ –æ–±—ä—è—Å–Ω–∏ –ü–û–ß–ï–ú–£ –∫–∞–∂–¥—ã–π —Ç—Ä–µ–∫ –ø–æ–¥—Ö–æ–¥–∏—Ç (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)

3. –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê (–ë–ï–ó –ê–ù–ê–õ–ò–ó–ê):
   üéµ –°—Ç–∏–ª—å: [–¢–û–ß–ù–´–ô –ø–æ–¥–∂–∞–Ω—Ä] [—ç–ø–æ—Ö–∞]
   
   üé∂ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
   1. [–ù–∞–∑–≤–∞–Ω–∏–µ] - [–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å] ([–ì–æ–¥]) | [–¢–æ—á–Ω—ã–π –∂–∞–Ω—Ä]
      üí° [–ö—Ä–∞—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ—á–µ–º—É –ø–æ–¥—Ö–æ–¥–∏—Ç]
   
   2. [–ù–∞–∑–≤–∞–Ω–∏–µ] - [–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å] ([–ì–æ–¥]) | [–¢–æ—á–Ω—ã–π –∂–∞–Ω—Ä]
      üí° [–ö—Ä–∞—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ]
   
   ...–∏ —Ç–∞–∫ –¥–∞–ª–µ–µ

–í–ê–ñ–ù–û: 
- –ù–ï –ø–∏—à–∏ –¥–ª–∏–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏–∑—ã`
                        }]
                    }]
                })
            });
            
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    const errorMsg = errorData.error?.message || `HTTP ${response.status}`;
                    lastError = new Error(`–ú–æ–¥–µ–ª—å ${model}, –∫–ª—é—á ${keyAttempt + 1}: ${response.status} - ${errorMsg}`);
                    lastErrorDetails = errorData;
                    console.warn(`‚ùå –ú–æ–¥–µ–ª—å ${model}, –∫–ª—é—á ${keyAttempt + 1} –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:`, lastError.message);
                    
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –∫–≤–æ—Ç—ã
                    if (errorMsg.includes('quota') || 
                        errorMsg.includes('Quota exceeded') ||
                        errorMsg.includes('exceeded your current quota')) {
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–ª–Ω–æ—Å—Ç—å—é –ª–∏ –∏—Å—á–µ—Ä–ø–∞–Ω–∞ –∫–≤–æ—Ç–∞ (limit: 0)
                        const quotaFullyExceeded = errorMsg.includes('limit: 0') || 
                                                   (errorData?.error?.details && 
                                                    errorData.error.details.some(d => d.quotaLimit === 0 || d.quotaLimit === '0'));
                        
                        if (quotaFullyExceeded) {
                            console.error('‚ö†Ô∏è –ö–≤–æ—Ç–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å—á–µ—Ä–ø–∞–Ω–∞ –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π! –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –ø–æ–ø—ã—Ç–∫–∏.');
                            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ–ª–∞–≥, —á—Ç–æ–±—ã –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏
                            quotaFullyExceededGlobal = true;
                            // –ï—Å–ª–∏ –∫–≤–æ—Ç–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å—á–µ—Ä–ø–∞–Ω–∞, –ø—Ä–µ–∫—Ä–∞—â–∞–µ–º –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏
                            lastError = new Error(`–ö–≤–æ—Ç–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å—á–µ—Ä–ø–∞–Ω–∞: ${errorMsg}`);
                            lastErrorDetails = errorData;
                            lastError.quotaFullyExceeded = true;
                            lastError.originalErrorMessage = errorMsg;
                            // –í—ã—Ö–æ–¥–∏–º –∏–∑ —Ü–∏–∫–ª–∞ –ø–æ –∫–ª—é—á–∞–º
                            break;
                        }
                        
                        console.warn(`‚ö†Ô∏è –ü—Ä–µ–≤—ã—à–µ–Ω–∞ –∫–≤–æ—Ç–∞ –¥–ª—è –º–æ–¥–µ–ª–∏ ${model}`);
                        
                        // –ï—Å–ª–∏ —ç—Ç–æ –º–æ–¥–µ–ª—å —Å "lite", —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –ø—Ä–æ–ø—É—Å–∫–∞ –≤—Å–µ—Ö "lite" –º–æ–¥–µ–ª–µ–π
                        if (model.includes('lite')) {
                            console.log('üîÑ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é —Ñ–ª–∞–≥ –ø—Ä–æ–ø—É—Å–∫–∞ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π —Å "lite" –∏–∑-–∑–∞ –Ω–∏–∑–∫–∏—Ö –ª–∏–º–∏—Ç–æ–≤');
                            skipLiteModels = true;
                            // –í—ã—Ö–æ–¥–∏–º –∏–∑ —Ü–∏–∫–ª–∞ –ø–æ –∫–ª—é—á–∞–º, —á—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–π –º–æ–¥–µ–ª–∏ (–±–µ–∑ "lite")
                            break;
                        } else {
                            // –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –º–æ–¥–µ–ª—å —Å "lite", –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –º–æ–¥–µ–ª—å
                            break;
                        }
                    }
                    
                    // –ï—Å–ª–∏ —ç—Ç–æ –æ—à–∏–±–∫–∞ 403 (–¥–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω) –∏–ª–∏ 401 (–Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω), –ø—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –∫–ª—é—á
                    if (response.status === 401 || response.status === 403) {
                        if (keyAttempt < GOOGLE_API_KEYS.length - 1) {
                            continue; // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –∫–ª—é—á
                        }
                        // –ï—Å–ª–∏ –≤—Å–µ –∫–ª—é—á–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏, –ø—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –º–æ–¥–µ–ª—å
                        break;
                    }
                    
                    // –î–ª—è –¥—Ä—É–≥–∏—Ö –æ—à–∏–±–æ–∫ –ø—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –º–æ–¥–µ–ª—å
                    break;
                }
            
            const data = await response.json();
                
                // –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ Google Gemini API
                if (!data.candidates || !data.candidates[0] || !data.candidates[0].content || !data.candidates[0].content.parts) {
                    console.error('–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ API:', data);
                    lastError = new Error('–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Ç Google AI');
                    continue;
                }
                
            const aiResponse = data.candidates[0].content.parts[0].text;
            
                if (!aiResponse || aiResponse.trim().length === 0) {
                    lastError = new Error('–ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –æ—Ç Google AI');
                    continue;
                }
                
                console.log(`‚úÖ –£—Å–ø–µ—à–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –º–æ–¥–µ–ª—å: ${model}, –∫–ª—é—á: ${keyAttempt + 1}`);
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –∫–ª—é—á –Ω–∞ —É—Å–ø–µ—à–Ω—ã–π
                currentApiKeyIndex = (currentApiKeyIndex + keyAttempt) % GOOGLE_API_KEYS.length;
                updateStatus('‚úÖ –û–Ω–ª–∞–π–Ω –ò–ò –∞–∫—Ç–∏–≤–µ–Ω', 'active');
                return aiResponse;
                
                } catch (error) {
                    console.warn(`–û—à–∏–±–∫–∞ —Å –º–æ–¥–µ–ª—å—é ${model}, –∫–ª—é—á ${keyAttempt + 1}:`, error);
                    lastError = error;
                    // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –∫–ª—é—á –¥–ª—è —ç—Ç–æ–π –º–æ–¥–µ–ª–∏
                    if (keyAttempt < GOOGLE_API_KEYS.length - 1) {
                        continue;
                    }
                    // –ï—Å–ª–∏ –≤—Å–µ –∫–ª—é—á–∏ –¥–ª—è —ç—Ç–æ–π –º–æ–¥–µ–ª–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏, –ø—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –º–æ–¥–µ–ª—å
                    break;
                }
            }
            
            // –ï—Å–ª–∏ –∫–≤–æ—Ç–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å—á–µ—Ä–ø–∞–Ω–∞, –ø—Ä–µ–∫—Ä–∞—â–∞–µ–º –ø–æ–ø—ã—Ç–∫–∏ —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏
            if (quotaFullyExceededGlobal || (lastError && lastError.quotaFullyExceeded)) {
                console.log('‚ö†Ô∏è –ö–≤–æ—Ç–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å—á–µ—Ä–ø–∞–Ω–∞, –ø—Ä–µ–∫—Ä–∞—â–∞—é –ø–æ–ø—ã—Ç–∫–∏ —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏');
                break;
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª–Ω–æ–≥–æ –∏—Å—á–µ—Ä–ø–∞–Ω–∏—è –∫–≤–æ—Ç—ã
        if (lastError && (lastError.quotaFullyExceeded || lastError.message.includes('–ö–≤–æ—Ç–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å—á–µ—Ä–ø–∞–Ω–∞'))) {
            // –ò–∑–≤–ª–µ–∫–∞–µ–º –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
            let retryAfter = null;
            const errorSource = lastError.originalErrorMessage || lastError.message || '';
            const retryMatch = errorSource.match(/retry in ([\d.]+)s/i) || 
                             errorSource.match(/Please retry in ([\d.]+)s/i);
            if (retryMatch) {
                retryAfter = Math.ceil(parseFloat(retryMatch[1]));
            }
            
            let errorMessage = `‚ùå **–ö–≤–æ—Ç–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å—á–µ—Ä–ø–∞–Ω–∞**\n\n` +
                              `**–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:**\n\n${lastError.message}\n\n` +
                              `**üîç –ü—Ä–æ–±–ª–µ–º–∞:** –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –∫–≤–æ—Ç–∞ –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π Google AI –∏—Å—á–µ—Ä–ø–∞–Ω–∞. –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –∫–æ–≥–¥–∞ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ –∏ –ø—Ä–µ–≤—ã—Å–∏–ª–∏ –¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤.\n\n` +
                              `**‚úÖ –†–µ—à–µ–Ω–∏–µ:**\n`;
            
            if (retryAfter) {
                const minutes = Math.floor(retryAfter / 60);
                const seconds = retryAfter % 60;
                errorMessage += `‚Ä¢ ‚è∞ –ü–æ–¥–æ–∂–¥–∏—Ç–µ ${minutes > 0 ? `${minutes} –º–∏–Ω ${seconds} —Å–µ–∫` : `${retryAfter} —Å–µ–∫—É–Ω–¥`} –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞\n`;
            } else {
                errorMessage += `‚Ä¢ ‚è∞ –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –∏–ª–∏ —á–∞—Å–æ–≤ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞\n`;
            }
            
            errorMessage += `‚Ä¢ üîë –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π API –∫–ª—é—á (–µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ)\n` +
                           `‚Ä¢ üí≥ –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –ø–ª–∞—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ Google AI\n` +
                           `‚Ä¢ üìä –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–≤–æ—Ç—ã –Ω–∞ https://ai.dev/usage?tab=rate-limit\n` +
                           `‚Ä¢ üîÑ –ö–≤–æ—Ç–∞ –æ–±—ã—á–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞\n\n` +
                           `**‚ÑπÔ∏è –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –≠—Ç–æ –Ω–µ –ø—Ä–æ–±–ª–µ–º–∞ –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏ - –∫–≤–æ—Ç–∞ –∏—Å—á–µ—Ä–ø–∞–Ω–∞ –¥–ª—è –≤—Å–µ–≥–æ API –∫–ª—é—á–∞.`;
            
            throw new Error(errorMessage);
        }
        
        // –ï—Å–ª–∏ –≤—Å–µ –º–æ–¥–µ–ª–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏, –ø–æ–ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
        let availableModelsHint = '';
        let quotaExceeded = false;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–∞ –ª–∏ –æ—à–∏–±–∫–∞ –∫–≤–æ—Ç—ã
        if (lastErrorDetails?.error?.message) {
            const errorMsg = lastErrorDetails.error.message;
            if (errorMsg.includes('quota') || 
                errorMsg.includes('Quota exceeded') ||
                errorMsg.includes('exceeded your current quota') ||
                errorMsg.includes('limit: 0')) {
                quotaExceeded = true;
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–ª–Ω–æ—Å—Ç—å—é –ª–∏ –∏—Å—á–µ—Ä–ø–∞–Ω–∞ –∫–≤–æ—Ç–∞
        const quotaFullyExceeded = lastError?.message?.includes('–ö–≤–æ—Ç–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å—á–µ—Ä–ø–∞–Ω–∞') ||
                                   lastErrorDetails?.error?.message?.includes('limit: 0') ||
                                   (lastErrorDetails?.error?.details && 
                                    lastErrorDetails.error.details.some(d => d.quotaLimit === 0 || d.quotaLimit === '0'));
        
        try {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º v1beta endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –º–æ–¥–µ–ª–µ–π
            const listUrl = `https://generativelanguage.googleapis.com/v1beta/models?key=${GOOGLE_API_KEY}`;
            const listResponse = await fetch(listUrl);
            if (listResponse.ok) {
                const listData = await listResponse.json();
                if (listData.models && listData.models.length > 0) {
                    // –§–∏–ª—å—Ç—Ä—É–µ–º –º–æ–¥–µ–ª–∏ –ë–ï–ó "lite" (—É –Ω–∏—Ö –Ω–∏–∑–∫–∏–µ –ª–∏–º–∏—Ç—ã)
                    const modelNames = listData.models
                        .filter(m => m.supportedGenerationMethods?.includes('generateContent'))
                        .map(m => m.name.replace('models/', ''))
                        .filter(m => !m.includes('lite')) // –ò—Å–∫–ª—é—á–∞–µ–º –º–æ–¥–µ–ª–∏ —Å –Ω–∏–∑–∫–∏–º–∏ –ª–∏–º–∏—Ç–∞–º–∏
                        .slice(0, 8);
                    if (modelNames.length > 0) {
                        availableModelsHint = `\n\nüìã –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏ (—Å –≤—ã—Å–æ–∫–∏–º–∏ –ª–∏–º–∏—Ç–∞–º–∏): ${modelNames.join(', ')}`;
                    }
                }
            }
        } catch (e) {
            console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π:', e);
        }
        
        // –ï—Å–ª–∏ –≤—Å–µ –º–æ–¥–µ–ª–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏
        console.error('–í—Å–µ –º–æ–¥–µ–ª–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏. –ü–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞:', lastError);
        updateStatus('‚ùå –û—à–∏–±–∫–∞ API', 'error');
        
        let errorMessage = '';
        
        // –ò–∑–≤–ª–µ–∫–∞–µ–º –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è
        let retryAfter = null;
        if (lastError?.message) {
            const retryMatch = lastError.message.match(/retry in ([\d.]+)s/i) || 
                             lastError.message.match(/Please retry in ([\d.]+)s/i);
            if (retryMatch) {
                retryAfter = Math.ceil(parseFloat(retryMatch[1]));
            }
        }
        
        if (quotaFullyExceeded) {
            // –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å—á–µ—Ä–ø–∞–Ω–∞ –∫–≤–æ—Ç–∞
            errorMessage = `‚ùå **–ö–≤–æ—Ç–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å—á–µ—Ä–ø–∞–Ω–∞**\n\n` +
                          `**–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:**\n\n${lastError?.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}\n\n` +
                          `**üîç –ü—Ä–æ–±–ª–µ–º–∞:** –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –∫–≤–æ—Ç–∞ –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π Google AI –∏—Å—á–µ—Ä–ø–∞–Ω–∞ (limit: 0). –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –∫–æ–≥–¥–∞ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ –∏ –ø—Ä–µ–≤—ã—Å–∏–ª–∏ –¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤.\n\n` +
                          `**‚úÖ –†–µ—à–µ–Ω–∏–µ:**\n`;
            
            if (retryAfter) {
                const minutes = Math.floor(retryAfter / 60);
                const seconds = retryAfter % 60;
                errorMessage += `‚Ä¢ ‚è∞ –ü–æ–¥–æ–∂–¥–∏—Ç–µ ${minutes > 0 ? `${minutes} –º–∏–Ω ${seconds} —Å–µ–∫` : `${retryAfter} —Å–µ–∫—É–Ω–¥`} –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞\n`;
            } else {
                errorMessage += `‚Ä¢ ‚è∞ –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –∏–ª–∏ —á–∞—Å–æ–≤ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞\n`;
            }
            
            errorMessage += `‚Ä¢ üîë –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π API –∫–ª—é—á (–µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ)\n` +
                           `‚Ä¢ üí≥ –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –ø–ª–∞—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ Google AI\n` +
                           `‚Ä¢ üìä –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–≤–æ—Ç—ã –Ω–∞ https://ai.dev/usage?tab=rate-limit\n` +
                           `‚Ä¢ üîÑ –ö–≤–æ—Ç–∞ –æ–±—ã—á–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞\n\n` +
                           `**‚ÑπÔ∏è –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –≠—Ç–æ –Ω–µ –ø—Ä–æ–±–ª–µ–º–∞ –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏ - –∫–≤–æ—Ç–∞ –∏—Å—á–µ—Ä–ø–∞–Ω–∞ –¥–ª—è –≤—Å–µ–≥–æ API –∫–ª—é—á–∞. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏ –Ω–µ –ø–æ–º–æ–∂–µ—Ç, –Ω—É–∂–Ω–æ –ø–æ–¥–æ–∂–¥–∞—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∫–≤–æ—Ç—ã –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –∫–ª—é—á.`;
        } else if (quotaExceeded) {
            errorMessage = `‚ùå **–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å –ò–ò**\n\n` +
                          `**–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:**\n\n${lastError?.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}\n\n` +
                          `**üîç –ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤.\n\n` +
                          `**‚úÖ –†–µ—à–µ–Ω–∏–µ:**\n` +
                          `‚Ä¢ –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—Å—è –Ω–∞ –º–æ–¥–µ–ª–∏ —Å –≤—ã—Å–æ–∫–∏–º–∏ –ª–∏–º–∏—Ç–∞–º–∏ (–ë–ï–ó "lite")\n` +
                          `‚Ä¢ –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞\n` +
                          `‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏–º–∏—Ç—ã –≤ Google Cloud Console\n` +
                          `‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π API –∫–ª—é—á –∏–∑ —Å–ø–∏—Å–∫–∞${availableModelsHint}\n\n` +
                          `**üîß –û—Ç–ª–∞–¥–∫–∞:**\n` +
                          `‚Ä¢ –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –¥–ª—è –¥–µ—Ç–∞–ª–µ–π\n` +
                          `‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ API –≤ –ø–∞–Ω–µ–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫\n` +
                          `‚Ä¢ –ü–æ–ø—Ä–æ–±–æ–≤–∞–Ω–æ –º–æ–¥–µ–ª–µ–π: ${modelsToTry.length}, –∫–ª—é—á–µ–π: ${GOOGLE_API_KEYS.length}`;
        } else {
            errorMessage = `‚ùå **–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å –ò–ò**\n\n` +
                          `**–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:**\n\n${lastError?.message || '–í—Å–µ –º–æ–¥–µ–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã'}${availableModelsHint}\n\n` +
                          `**üîç –ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Google AI.\n\n` +
                          `**‚úÖ –†–µ—à–µ–Ω–∏–µ:**\n` +
                          `‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É\n` +
                          `‚Ä¢ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ API –∫–ª—é—á –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏ –∞–∫—Ç–∏–≤–µ–Ω\n` +
                          `‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º–æ–¥–µ–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –≤–∞—à–µ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞\n` +
                          `‚Ä¢ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É\n\n` +
                          `**üîß –û—Ç–ª–∞–¥–∫–∞:**\n` +
                          `‚Ä¢ –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –¥–ª—è –¥–µ—Ç–∞–ª–µ–π\n` +
                          `‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ API –≤ –ø–∞–Ω–µ–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫`;
        }
        
        throw new Error(errorMessage);
    }

    // ==================== –£–ú–ù–´–ô –õ–û–ö–ê–õ–¨–ù–´–ô –ò–ò ====================

    async function generateSmartLocalResponse(message) {
        // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ –º—ã—à–ª–µ–Ω–∏—è –ò–ò
        await new Promise(resolve => setTimeout(resolve, 800 + Math.random() * 1200));
        
        const lowerMsg = message.toLowerCase();
        
        // –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∑–∞–ø—Ä–æ—Å–∞
        if (isSearchQuery(lowerMsg)) {
            return await handleIntelligentSearch(message);
        } else if (isRecommendationQuery(lowerMsg)) {
            return await handleIntelligentRecommendation(message);
        } else if (isAnalysisQuery(lowerMsg)) {
            return await handleIntelligentAnalysis(message);
        } else if (isGreeting(lowerMsg)) {
            return getAIgreeting();
        } else {
            return getContextualResponse(message);
        }
    }

    function isSearchQuery(text) {
        const keywords = ['–Ω–∞–π–¥–∏', '–∏—â–∏', '–ø–æ–∏—Å–∫', '–Ω–∞–π—Ç–∏', '–ø–æ–¥–±–µ—Ä–∏', '–≥–¥–µ –ø–µ—Å–Ω—è', '–∫–∞–∫–∞—è –ø–µ—Å–Ω—è'];
        return keywords.some(keyword => text.includes(keyword));
    }

    function isRecommendationQuery(text) {
        const keywords = ['—Ä–µ–∫–æ–º–µ–Ω–¥', '–ø–æ—Å–æ–≤–µ—Ç—É–π', '—á—Ç–æ –ø–æ—Å–ª—É—à–∞—Ç—å', '–ø–æ–¥—Å–∫–∞–∂–∏ –º—É–∑—ã–∫—É', '–ø–æ—Å–æ–≤–µ—Ç—É–π —Ç—Ä–µ–∫'];
        return keywords.some(keyword => text.includes(keyword));
    }

    function isAnalysisQuery(text) {
        const keywords = ['–∞–Ω–∞–ª–∏–∑', '—Ä–∞—Å—Å–∫–∞–∂–∏ –æ', '—á—Ç–æ —Ç–∞–∫–æ–µ', '–æ–±—ä—è—Å–Ω–∏', '–∂–∞–Ω—Ä', '—Å—Ç–∏–ª—å'];
        return keywords.some(keyword => text.includes(keyword));
    }

    function isGreeting(text) {
        const greetings = ['–ø—Ä–∏–≤–µ—Ç', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π', '—Ö–∞–π', 'hello', '–¥–æ–±—Ä—ã–π', '–∑–¥–∞—Ä–æ–≤–∞'];
        return greetings.some(greeting => text.includes(greeting));
    }

    async function handleIntelligentSearch(query) {
        const keywords = extractSmartKeywords(query);
        const results = intelligentSearch(keywords);
        
        if (results.length > 0) {
            let response = `üéØ –ù–∞—à–µ–ª –º—É–∑—ã–∫—É –ø–æ –∑–∞–ø—Ä–æ—Å—É "${query}":**\n\n`;
            
            results.slice(0, 4).forEach((song, index) => {
                const matchScore = calculateMatchScore(song, keywords);
                const emoji = getSongEmoji(song.mood);
                
                response += `${index + 1}. **${song.title}** - ${song.artist} ${emoji}\n`;
                response += `   üéµ –ñ–∞–Ω—Ä: ${song.genre}\n`;
                response += `   üìÖ –ì–æ–¥: ${song.year} | üéö BPM: ${song.bpm}\n`;
                response += `   üí´ ${song.description}\n`;
                response += `   üéØ –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ: ${matchScore}%\n\n`;
            });
            
            response += "‚ú® *–•–æ—Ç–∏—Ç–µ –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–∞–∫–æ–π-—Ç–æ –∏–∑ —ç—Ç–∏—Ö –ø–µ—Å–µ–Ω?*";
            return response;
        } else {
            return `üîç **–ü–æ –∑–∞–ø—Ä–æ—Å—É "${query}" –Ω–µ –Ω–∞—à–µ–ª —Ç–æ—á–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π.**\n\nüí° **–°–æ–≤–µ—Ç—ã –¥–ª—è –ø–æ–∏—Å–∫–∞:**\n‚Ä¢ –û–ø–∏—à–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ ("–≥—Ä—É—Å—Ç–Ω–∞—è –º—É–∑—ã–∫–∞ –¥–ª—è –≤–µ—á–µ—Ä–∞")\n‚Ä¢ –£–∫–∞–∂–∏—Ç–µ –∂–∞–Ω—Ä ("—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –º—É–∑—ã–∫–∞ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏")\n‚Ä¢ –í—Å–ø–æ–º–Ω–∏—Ç–µ –¥–µ—Ç–∞–ª–∏ ("–ø–µ—Å–Ω—è —Å –≥–∏—Ç–∞—Ä–Ω—ã–º —Ä–∏—Ñ–æ–º")\n\nüéß *–ò–ª–∏ —Å–ø—Ä–æ—Å–∏—Ç–µ —É –º–µ–Ω—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏!*`;
        }
    }

    async function handleIntelligentRecommendation(query) {
        const mood = detectMood(query);
        const genre = detectGenre(query);
        const activity = detectActivity(query);
        
        const recommendations = getSmartRecommendations(mood, genre, activity);
        
        let response = `üéµ **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –≤–∞—Å:**\n\n`;
        
        recommendations.forEach((song, index) => {
            const reason = getRecommendationReason(song, mood, activity);
            
            response += `${index + 1}. **${song.title}** - ${song.artist}\n`;
            response += `   üé≠ ${song.mood} | ${song.genre}\n`;
            response += `   üíñ ${reason}\n`;
            response += `   üéß ${song.description}\n\n`;
        });
        
        response += "‚ú® *–≠—Ç–∏ —Ç—Ä–µ–∫–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –ø–æ–¥–æ–±—Ä–∞–Ω—ã –ø–æ–¥ –≤–∞—à –∑–∞–ø—Ä–æ—Å!*";
        return response;
    }

    async function handleIntelligentAnalysis(query) {
        const songMatch = findSongInQuery(query);
        
        if (songMatch) {
            return generateDetailedAnalysis(songMatch);
        } else {
            const topic = detectMusicTopic(query);
            return getTopicExplanation(topic);
        }
    }

    // ==================== –ò–ù–¢–ï–õ–õ–ï–ö–¢–£–ê–õ–¨–ù–´–ô –ü–û–ò–°–ö ====================

    function intelligentSearch(keywords) {
        return musicDatabase
            .map(song => {
                let score = 0;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –ø–æ–ª—è –ø–µ—Å–Ω–∏
                const searchFields = [
                    { field: 'title', weight: 15 },
                    { field: 'artist', weight: 12 },
                    { field: 'genre', weight: 10 },
                    { field: 'description', weight: 8 },
                    { field: 'mood', weight: 6 },
                    { field: 'features', weight: 5 }
                ];
                
                keywords.forEach(keyword => {
                    searchFields.forEach(({ field, weight }) => {
                        if (field === 'features') {
                            if (song[field].some(f => f.includes(keyword))) {
                                score += weight;
                            }
                        } else {
                            if (song[field].toLowerCase().includes(keyword)) {
                                score += weight;
                            }
                        }
                    });
                });
                
                return { ...song, score };
            })
            .filter(song => song.score > 0)
            .sort((a, b) => b.score - a.score);
    }

    function extractSmartKeywords(text) {
        // –£–¥–∞–ª—è–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞ –∏ –ø–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–∏–º—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
        const stopWords = ['–∏', '–∏–ª–∏', '–Ω–æ', '–∞', '–≤', '–Ω–∞', '—Å', '–ø–æ', '–¥–ª—è', '—á—Ç–æ', '–∫–∞–∫', '–ø—Ä–æ', '–æ–±', '–æ—Ç', '–∏–∑', '—É', '–æ', '–∑–∞'];
        const words = text.toLowerCase()
            .replace(/[^\w\s–∞-—è–ê-–Ø]/g, ' ')
            .split(' ')
            .filter(word => word.length > 2 && !stopWords.includes(word));
        
        return [...new Set(words)]; // –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞
    }

    function calculateMatchScore(song, keywords) {
        let baseScore = 60;
        keywords.forEach(keyword => {
            const songText = `${song.title} ${song.artist} ${song.genre} ${song.description} ${song.mood} ${song.features.join(' ')}`.toLowerCase();
            if (songText.includes(keyword)) {
                baseScore += 10;
            }
        });
        return Math.min(98, baseScore);
    }

    // ==================== –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–û–ù–ù–ê–Ø –°–ò–°–¢–ï–ú–ê ====================

    function detectMood(text) {
        const moodPatterns = {
            '–≥—Ä—É—Å—Ç–Ω': '–º–µ–ª–∞–Ω—Ö–æ–ª–∏—á–Ω–æ–µ',
            '–≤–µ—Å–µ–ª': '—Ä–∞–¥–æ—Å—Ç–Ω–æ–µ',
            '—ç–Ω–µ—Ä–≥–∏': '—ç–Ω–µ—Ä–≥–∏—á–Ω–æ–µ',
            '—Ä–∞—Å—Å–ª–∞–±–ª': '—Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω–æ–µ',
            '—Ä–æ–º–∞–Ω—Ç': '—Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ',
            '–Ω–æ—Å—Ç–∞–ª—å–≥': '–Ω–æ—Å—Ç–∞–ª—å–≥–∏—á–µ—Å–∫–æ–µ',
            '–∞–≥—Ä–µ—Å—Å–∏–≤': '–∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ',
            '—Å–ø–æ–∫–æ–π–Ω': '—Å–ø–æ–∫–æ–π–Ω–æ–µ',
            '–º–µ—á—Ç–∞—Ç–µ–ª—å–Ω': '–º–µ—á—Ç–∞—Ç–µ–ª—å–Ω–æ–µ'
        };
        
        for (const [pattern, mood] of Object.entries(moodPatterns)) {
            if (text.includes(pattern)) return mood;
        }
        return null;
    }

    function detectGenre(text) {
        const genres = {
            '–ø–æ–ø': '–ø–æ–ø',
            '—Ä–æ–∫': '—Ä–æ–∫',
            '—Ä—ç–ø': '—Ö–∏–ø-—Ö–æ–ø',
            '—Ö–∏–ø-—Ö–æ–ø': '—Ö–∏–ø-—Ö–æ–ø',
            '—ç–ª–µ–∫—Ç—Ä–æ–Ω': '—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è',
            '–¥–∂–∞–∑': '–¥–∂–∞–∑',
            '–∫–ª–∞—Å—Å–∏—á': '–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è',
            '–∏–Ω–¥–∏': '–∏–Ω–¥–∏',
            '–º–µ—Ç–∞–ª': '–º–µ—Ç–∞–ª',
            '–¥–∏—Å–∫–æ': '–¥–∏—Å–∫–æ',
            '—Ñ–∞–Ω–∫': '—Ñ–∞–Ω–∫',
            '—Å–æ—É–ª': '—Å–æ—É–ª',
            '—Å–∏–Ω—Ç–∏-–ø–æ–ø': '—Å–∏–Ω—Ç–∏-–ø–æ–ø',
            '–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤': '–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π'
        };
        
        for (const [keyword, genre] of Object.entries(genres)) {
            if (text.includes(keyword)) return genre;
        }
        return null;
    }

    function detectActivity(text) {
        const activities = {
            '—Ç—Ä–µ–Ω': '—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏',
            '—Å–ø–æ—Ä—Ç': '—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏',
            '–±–µ–≥': '—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏',
            '—Ä–∞–±–æ—Ç': '—Ä–∞–±–æ—Ç—ã',
            '—É—á–µ': '—É—á–µ–±—ã',
            '—á—Ç–µ–Ω–∏': '—á—Ç–µ–Ω–∏—è',
            '–≤–æ–¥': '–≤–æ–∂–¥–µ–Ω–∏—è',
            '–¥–æ—Ä–æ–≥': '–ø–æ–µ–∑–¥–∫–∏',
            '–≤–µ—á–µ—Ä': '–≤–µ—á–µ—Ä–∞',
            '—É—Ç—Ä': '—É—Ç—Ä–∞',
            '–Ω–æ—á': '–Ω–æ—á–∏',
            '–æ—Ç–¥—ã—Ö': '–æ—Ç–¥—ã—Ö–∞',
            '—Ä–µ–ª–∞–∫—Å': '—Ä–µ–ª–∞–∫—Å–∞—Ü–∏–∏',
            '–≤–µ—á–µ—Ä–∏–Ω': '–≤–µ—á–µ—Ä–∏–Ω–∫–∏'
        };
        
        for (const [keyword, activity] of Object.entries(activities)) {
            if (text.includes(keyword)) return activity;
        }
        return null;
    }

    function getSmartRecommendations(mood, genre, activity) {
        let filteredSongs = [...musicDatabase];
        
        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º
        if (mood) {
            filteredSongs = filteredSongs.filter(song => 
                song.mood.toLowerCase().includes(mood.substring(0, 5))
            );
        }
        
        if (genre) {
            filteredSongs = filteredSongs.filter(song => 
                song.genre.toLowerCase().includes(genre.substring(0, 5))
            );
        }
        
        // –ï—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã –Ω–µ –¥–∞–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–º–Ω—ã–π –ø–æ–¥–±–æ—Ä
        if (filteredSongs.length === 0) {
            filteredSongs = [...musicDatabase]
                .sort(() => Math.random() - 0.5)
                .slice(0, 8);
        }
        
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
        return filteredSongs
            .sort((a, b) => {
                let scoreA = 0, scoreB = 0;
                
                if (mood && a.mood.toLowerCase().includes(mood.substring(0, 3))) scoreA += 20;
                if (mood && b.mood.toLowerCase().includes(mood.substring(0, 3))) scoreB += 20;
                
                if (genre && a.genre.toLowerCase().includes(genre.substring(0, 3))) scoreA += 15;
                if (genre && b.genre.toLowerCase().includes(genre.substring(0, 3))) scoreB += 15;
                
                return scoreB - scoreA;
            })
            .slice(0, 5);
    }

    function getRecommendationReason(song, mood, activity) {
        const reasons = [
            `–ò–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è ${activity || '–ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è'}`,
            `–°–æ–∑–¥–∞–µ—Ç ${mood || '–Ω—É–∂–Ω–æ–µ'} –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ`,
            `–°–æ—á–µ—Ç–∞–µ—Ç –≤ —Å–µ–±–µ ${song.features.slice(0, 2).join(' –∏ ')}`,
            `–ü–æ–ø—É–ª—è—Ä–Ω—ã–π –≤—ã–±–æ—Ä –¥–ª—è ${activity || '—ç—Ç–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫'}`,
            `–û—Ç–ª–∏—á–Ω—ã–π –ø—Ä–∏–º–µ—Ä ${song.genre} –º—É–∑—ã–∫–∏`
        ];
        
        return reasons[Math.floor(Math.random() * reasons.length)];
    }

    // ==================== –ê–ù–ê–õ–ò–¢–ò–ö–ê ====================

    function generateDetailedAnalysis(song) {
        const analysisTemplates = [
            `üéµ –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ "${song.title}"\n\n` +
            `–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å: ${song.artist}\n` +
            `–ñ–∞–Ω—Ä: ${song.genre}\n` +
            `–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞: ${song.year}\n` +
            `–¢–µ–º–ø: ${song.bpm} BPM (${getTempoDescription(song.bpm)})\n\n` +
            `–ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:\n` +
            `${song.features.map(f => `‚Ä¢ ${f.charAt(0).toUpperCase() + f.slice(1)}`).join('\n')}\n\n` +
            `–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å: ${song.mood}\n` +
            `–û–ø–∏—Å–∞–Ω–∏–µ: ${song.description}\n\n` +
            `üéß *–ö—É–ª—å—Ç–æ–≤—ã–π —Ç—Ä–µ–∫, –æ–∫–∞–∑–∞–≤—à–∏–π –≤–ª–∏—è–Ω–∏–µ –Ω–∞ ${getInfluenceDescription(song)}*`,
            
            `üß† –ù–µ–π—Ä–æ-–∞–Ω–∞–ª–∏–∑ ${song.title}\n\n` +
            `–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:\n` +
            `‚Ä¢ –≠–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞: ${getEnergyLevel(song.bpm)}/10\n` +
            `‚Ä¢ –°–ª–æ–∂–Ω–æ—Å—Ç—å –∞—Ä–∞–Ω–∂–∏—Ä–æ–≤–∫–∏: ${7 + Math.floor(Math.random() * 3)}/10\n` +
            `‚Ä¢ –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞: ${8 + Math.floor(Math.random() * 2)}/10\n\n` +
            `–ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã:\n` +
            `üé∏ ${getRandomInstrument()}\n` +
            `üéπ ${getRandomInstrument()}\n` +
            `üé§ ${getVocalStyle()}\n\n` +
            `–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç: ${getHistoricalContext(song.year)}\n` +
            `–ü–æ—Ö–æ–∂–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏: ${getSimilarArtists(song.genre)}\n\n` +
            `üìä –û—Ü–µ–Ω–∫–∞ –∫—É–ª—å—Ç—É—Ä–Ω–æ–≥–æ –≤–ª–∏—è–Ω–∏—è: ${8 + Math.floor(Math.random() * 2)}/10*`
        ];
        
        return analysisTemplates[Math.floor(Math.random() * analysisTemplates.length)];
    }

    function detectMusicTopic(text) {
        const topics = [
            '—Å–∏–Ω—Ç–∏-–ø–æ–ø', '—Ä–æ–∫', '—Ö–∏–ø-—Ö–æ–ø', '—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –º—É–∑—ã–∫–∞', 
            '–¥–∂–∞–∑', '–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –º—É–∑—ã–∫–∞', '–∏–Ω–¥–∏', '–º–µ—Ç–∞–ª', '–¥–∏—Å–∫–æ'
        ];
        
        for (const topic of topics) {
            if (text.includes(topic)) return topic;
        }
        return '–º—É–∑—ã–∫–∞';
    }

    function getTopicExplanation(topic) {
        const explanations = {
            '—Å–∏–Ω—Ç–∏-–ø–æ–ø': 'üéπ –°–∏–Ω—Ç–∏-–ø–æ–ø - –∂–∞–Ω—Ä —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –º—É–∑—ã–∫–∏ —Å —É–ø–æ—Ä–æ–º –Ω–∞ —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä—ã, –ø–æ–ø—É–ª—è—Ä–Ω—ã–π –≤ 80-—Ö. –•–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É–µ—Ç—Å—è –º–µ–ª–æ–¥–∏—á–Ω–æ—Å—Ç—å—é, –Ω–æ—Å—Ç–∞–ª—å–≥–∏—á–µ—Å–∫–∏–º –∑–≤—É—á–∞–Ω–∏–µ–º –∏ —Ç–∞–Ω—Ü–µ–≤–∞–ª—å–Ω—ã–º–∏ —Ä–∏—Ç–º–∞–º–∏. –ü—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–∏: The Weeknd, Dua Lipa, A-ha.',
            '—Ä–æ–∫': 'üé∏ –†–æ–∫ - –∂–∞–Ω—Ä –º—É–∑—ã–∫–∏ —Å —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–º–∏ –≥–∏—Ç–∞—Ä–∞–º–∏, —É–¥–∞—Ä–Ω—ã–º–∏ –∏ –º–æ—â–Ω—ã–º –≤–æ–∫–∞–ª–æ–º. –í–∫–ª—é—á–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–æ–¥–∂–∞–Ω—Ä–æ–≤: –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ä–æ–∫, –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π, –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π, –ø–∞–Ω–∫-—Ä–æ–∫. –ü—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–∏: Queen, The Beatles, Led Zeppelin.',
            '—Ö–∏–ø-—Ö–æ–ø': 'üé§ –•–∏–ø-—Ö–æ–ø - –º—É–∑—ã–∫–∞–ª—å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å —Ä–µ—á–∏—Ç–∞—Ç–∏–≤–æ–º, –±–∏—Ç–∞–º–∏ –∏ —Å–µ–º–ø–ª–∞–º–∏. –í–æ–∑–Ω–∏–∫ –≤ 70-—Ö –≤ –∞—Ñ—Ä–æ–∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏—Ö —Å–æ–æ–±—â–µ—Å—Ç–≤–∞—Ö. –í–∫–ª—é—á–∞–µ—Ç —Ä—ç–ø, –±—Ä–µ–π–∫–¥–∞–Ω—Å, –≥—Ä–∞—Ñ—Ñ–∏—Ç–∏. –ü—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–∏: Eminem, Kendrick Lamar, Drake.',
            '—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –º—É–∑—ã–∫–∞': '‚ö° –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –º—É–∑—ã–∫–∞ - —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤. –í–∫–ª—é—á–∞–µ—Ç —Ö–∞—É—Å, —Ç–µ—Ö–Ω–æ, –¥—Ä–∞–º-–Ω-–±–µ–π—Å, —Ç—Ä–∞–Ω—Å, EDM. –ü—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–∏: Daft Punk, Calvin Harris, Avicii.',
            '–¥–∂–∞–∑': 'üé∑ –î–∂–∞–∑ - –º—É–∑—ã–∫–∞–ª—å–Ω—ã–π –∂–∞–Ω—Ä —Å –∏–º–ø—Ä–æ–≤–∏–∑–∞—Ü–∏–µ–π, —Å–ª–æ–∂–Ω—ã–º–∏ –≥–∞—Ä–º–æ–Ω–∏—è–º–∏ –∏ —Å–≤–∏–Ω–≥–æ–º. –í–æ–∑–Ω–∏–∫ –≤ –∫–æ–Ω—Ü–µ 19 - –Ω–∞—á–∞–ª–µ 20 –≤–µ–∫–∞. –°—Ç–∏–ª–∏: –±–∏–±–æ–ø, –∫—É–ª-–¥–∂–∞–∑, —Ñ—å—é–∂–Ω. –ü—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–∏: Louis Armstrong, Miles Davis, Ella Fitzgerald.',
            '–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –º—É–∑—ã–∫–∞': 'üéª –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –º—É–∑—ã–∫–∞ - –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∞—è –º—É–∑—ã–∫–∞ –µ–≤—Ä–æ–ø–µ–π—Å–∫–æ–π —Ç—Ä–∞–¥–∏—Ü–∏–∏. –•–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É–µ—Ç—Å—è —Å–ª–æ–∂–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π, —Å–∏–º—Ñ–æ–Ω–∏—á–µ—Å–∫–∏–º –∑–≤—É—á–∞–Ω–∏–µ–º. –ü–µ—Ä–∏–æ–¥—ã: –±–∞—Ä–æ–∫–∫–æ, –∫–ª–∞—Å—Å–∏—Ü–∏–∑–º, —Ä–æ–º–∞–Ω—Ç–∏–∑–º. –ö–æ–º–ø–æ–∑–∏—Ç–æ—Ä—ã: –ë–∞—Ö, –ú–æ—Ü–∞—Ä—Ç, –ë–µ—Ç—Ö–æ–≤–µ–Ω.',
            '–∏–Ω–¥–∏': 'üé® –ò–Ω–¥–∏-–º—É–∑—ã–∫–∞ - –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞—è –º—É–∑—ã–∫–∞, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω–∞—è —Å –º–µ–π–¥–∂–æ—Ä-–ª–µ–π–±–ª–∞–º–∏. –ß–∞—Å—Ç–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è, —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∑–≤—É—á–∞–Ω–∏–µ–º. –ü—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–∏: Arcade Fire, Tame Impala, The Strokes.',
            '–º–µ—Ç–∞–ª': 'ü§ò –ú–µ—Ç–∞–ª - –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –∂–∞–Ω—Ä —Ä–æ–∫-–º—É–∑—ã–∫–∏ —Å –∏—Å–∫–∞–∂–µ–Ω–Ω—ã–º–∏ –≥–∏—Ç–∞—Ä–∞–º–∏, –±—ã—Å—Ç—Ä—ã–º–∏ —Ä–∏—Ç–º–∞–º–∏. –ü–æ–¥–∂–∞–Ω—Ä—ã: —Ö–µ–≤–∏-–º–µ—Ç–∞–ª, —Ç—Ä—ç—à-–º–µ—Ç–∞–ª, –¥—É–º-–º–µ—Ç–∞–ª. –ü—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–∏: Metallica, Iron Maiden, Black Sabbath.',
            '–¥–∏—Å–∫–æ': 'üíÉ –î–∏—Å–∫–æ - —Ç–∞–Ω—Ü–µ–≤–∞–ª—å–Ω–∞—è –º—É–∑—ã–∫–∞ 70-—Ö —Å —á–µ—Ç—ã—Ä—å–º—è —É–¥–∞—Ä–∞–º–∏ –≤ —Ç–∞–∫—Ç, —Å—Ç—Ä—É–Ω–Ω—ã–º–∏ –∞—Ä–∞–Ω–∂–∏—Ä–æ–≤–∫–∞–º–∏. –ó–æ–ª–æ—Ç–∞—è —ç—Ä–∞ –¥–∏—Å–∫–æ: 1975-1979. –ü—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–∏: Bee Gees, Donna Summer, ABBA.',
            '–º—É–∑—ã–∫–∞': 'üéµ –ú—É–∑—ã–∫–∞ - –∏—Å–∫—É—Å—Å—Ç–≤–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∑–≤—É–∫–æ–≤ –≤–æ –≤—Ä–µ–º–µ–Ω–∏. –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –º–µ–ª–æ–¥–∏—é, –≥–∞—Ä–º–æ–Ω–∏—é, —Ä–∏—Ç–º, —Ç–µ–º–±—Ä. –í–ª–∏—è–µ—Ç –Ω–∞ —ç–º–æ—Ü–∏–∏, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ç–µ—Ä–∞–ø–∏–∏, –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –∫—É–ª—å—Ç—É—Ä—ã.'
        };
        
        return explanations[topic] || explanations['–º—É–∑—ã–∫–∞'];
    }

    // ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================

    function getAIgreeting() {
        const greetings = [
            "–ü—Ä–∏–≤–µ—Ç! üéµ –Ø –≤–∞—à –º—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫. –ì–æ—Ç–æ–≤ –ø–æ–º–æ—á—å –Ω–∞–π—Ç–∏ –∏–¥–µ–∞–ª—å–Ω—É—é –º—É–∑—ã–∫—É!",
            "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! üé∂ –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å –≤ –º–∏—Ä–µ –º—É–∑—ã–∫–∏ —Å–µ–≥–æ–¥–Ω—è?",
            "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é! üéß –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ, –∫–∞–∫—É—é –º—É–∑—ã–∫—É –∏—â–µ—Ç–µ –∏–ª–∏ —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–∑–Ω–∞—Ç—å?",
            "–î–æ–±—Ä—ã–π –¥–µ–Ω—å! üé∏ –Ø –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –ø–æ–º–æ—á—å –≤–∞–º —Å –º—É–∑—ã–∫–∞–ª—å–Ω—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏ –∏ –ø–æ–∏—Å–∫–æ–º!"
        ];
        return greetings[Math.floor(Math.random() * greetings.length)];
    }

    function getContextualResponse(query) {
        const responses = [
            `–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –∑–∞–ø—Ä–æ—Å: "${query}" üéµ –ù–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–æ–≥–æ —è –±—ã —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–ª –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –≥–∏–±—Ä–∏–¥–Ω—ã–µ –∂–∞–Ω—Ä—ã.`,
            `üé∂ –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –≤–∞—à –≤–æ–ø—Ä–æ—Å –æ "${query}"... –ú—É–∑—ã–∫–∞ - —ç—Ç–æ –≥–ª—É–±–æ–∫–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–æ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π!`,
            `üéß –ó–∞–ø—Ä–æ—Å "${query}" –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –º—É–∑—ã–∫–∏! –ú–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ –∏–ª–∏ –Ω–∞–π—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç—Ä–µ–∫–∏.`,
            `üéµ "${query}" - –æ—Ç–ª–∏—á–Ω–∞—è —Ç–µ–º–∞! –ú—É–∑—ã–∫–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç, –∏ –≤ —ç—Ç–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å —á—Ç–æ –æ—Ç–∫—Ä—ã—Ç—å.`
        ];
        return responses[Math.floor(Math.random() * responses.length)];
    }

    function findSongInQuery(text) {
        for (const song of musicDatabase) {
            const songLower = song.title.toLowerCase();
            const artistLower = song.artist.toLowerCase();
            const textLower = text.toLowerCase();
            
            if (textLower.includes(songLower) || textLower.includes(artistLower)) {
                return song;
            }
        }
        return null;
    }

    function getSongEmoji(mood) {
        const emojiMap = {
            '–Ω–æ—Å—Ç–∞–ª—å–≥–∏—è': 'üï∞Ô∏è',
            '—ç–Ω–µ—Ä–≥–∏—è': '‚ö°',
            '–±—É–Ω—Ç': 'ü§ò',
            '—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å': 'üí™',
            '—Ä–∞–¥–æ—Å—Ç—å': 'üòä',
            '—Ç–∞–Ω—Ü—ã': 'üíÉ',
            '–º–µ—á—Ç–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å': 'üåå',
            '–≥—Ä—É—Å—Ç—å': 'üò¢',
            '—ç–º–æ—Ü–∏–∏': '‚ù§Ô∏è',
            '–æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ': 'üïäÔ∏è',
            '–∞–º–±–∏—Ü–∏–∏': 'üéØ',
            '–º–æ—â—å': 'üí•',
            '–¥—Ä–∞–º–∞': 'üé≠',
            '—Ç–µ–∞—Ç—Ä–∞–ª—å–Ω–æ—Å—Ç—å': 'üé™',
            '–Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ': '‚ö°'
        };
        
        for (const [keyword, emoji] of Object.entries(emojiMap)) {
            if (mood.includes(keyword)) return emoji;
        }
        return 'üéµ';
    }

    function getTempoDescription(bpm) {
        if (bpm < 60) return '–æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ';
        if (bpm < 80) return '–º–µ–¥–ª–µ–Ω–Ω–æ';
        if (bpm < 100) return '—É–º–µ—Ä–µ–Ω–Ω–æ';
        if (bpm < 120) return '—Å—Ä–µ–¥–Ω–µ';
        if (bpm < 140) return '–±—ã—Å—Ç—Ä–æ';
        return '–æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ';
    }

    function getEnergyLevel(bpm) {
        if (bpm < 80) return 3;
        if (bpm < 100) return 5;
        if (bpm < 120) return 7;
        if (bpm < 140) return 8;
        return 9;
    }

    function getRandomInstrument() {
        const instruments = ['–≠–ª–µ–∫—Ç—Ä–æ–≥–∏—Ç–∞—Ä–∞', '–°–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä', '–ë–∞—Å-–≥–∏—Ç–∞—Ä–∞', '–£–¥–∞—Ä–Ω—ã–µ', '–°—Ç—Ä—É–Ω–Ω—ã–µ', '–î—É—Ö–æ–≤—ã–µ', '–ü–∏–∞–Ω–∏–Ω–æ', '–°–∞–∫—Å–æ—Ñ–æ–Ω', '–°–∫—Ä–∏–ø–∫–∞', '–í–∏–æ–ª–æ–Ω—á–µ–ª—å'];
        return instruments[Math.floor(Math.random() * instruments.length)];
    }

    function getVocalStyle() {
        const styles = ['–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –≤–æ–∫–∞–ª', '–®–µ–ø–æ—Ç–Ω—ã–π –≤–æ–∫–∞–ª', '–ú–æ—â–Ω—ã–π –≤–æ–∫–∞–ª', '–ú–µ–ª–æ–¥–∏—á–Ω—ã–π –≤–æ–∫–∞–ª', '–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –≤–æ–∫–∞–ª', '–†—ç–ø-–≤–æ–∫–∞–ª', '–û–ø–µ—Ä–Ω—ã–π –≤–æ–∫–∞–ª'];
        return styles[Math.floor(Math.random() * styles.length)];
    }

    function getHistoricalContext(year) {
        if (year < 1960) return "–≠–ø–æ—Ö–∞ —Ä–æ–∫-–Ω-—Ä–æ–ª–ª–∞ –∏ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–≥–æ –¥–∂–∞–∑–∞";
        if (year < 1970) return "–í—Ä–µ–º—è –±–∏—Ç–ª–æ–º–∞–Ω–∏–∏ –∏ –ø—Å–∏—Ö–æ–¥–µ–ª–∏—á–µ—Å–∫–æ–≥–æ —Ä–æ–∫–∞";
        if (year < 1980) return "–†–∞—Å—Ü–≤–µ—Ç –¥–∏—Å–∫–æ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–≥–æ —Ä–æ–∫–∞";
        if (year < 1990) return "–≠—Ä–∞ —Å–∏–Ω—Ç-–ø–æ–ø–∞ –∏ –Ω–æ–≤–æ–π –≤–æ–ª–Ω—ã";
        if (year < 2000) return "–í—Ä–µ–º—è –≥—Ä–∞–Ω–∂–∞ –∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ —Ä–æ–∫–∞";
        if (year < 2010) return "–≠–ø–æ—Ö–∞ –ø–æ–ø-–ø–∞–Ω–∫–∞ –∏ R&B";
        if (year < 2020) return "–†–∞—Å—Ü–≤–µ—Ç —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –º—É–∑—ã–∫–∏ –∏ –∏–Ω–¥–∏-—Å—Ü–µ–Ω—ã";
        return "–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã –∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã";
    }

    function getInfluenceDescription(song) {
        const influences = [
            '—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–æ–ø-–º—É–∑—ã–∫—É',
            '—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é —Å—Ü–µ–Ω—É',
            '–∏–Ω–¥–∏-–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π',
            '–º–æ–ª–æ–¥—ã—Ö –º—É–∑—ã–∫–∞–Ω—Ç–æ–≤',
            '–∑–≤—É—á–∞–Ω–∏–µ 2020-—Ö –≥–æ–¥–æ–≤'
        ];
        return influences[Math.floor(Math.random() * influences.length)];
    }

    function getSimilarArtists(genre) {
        const artistsMap = {
            'Synth-pop': 'The Weeknd, Dua Lipa, Future Islands, The 1975',
            'Electropop': 'Billie Eilish, FKA twigs, Grimes, Lorde',
            'Disco': 'Dua Lipa, Jessie Ware, R√≥is√≠n Murphy, Kylie Minogue',
            'Indie Pop': 'Glass Animals, Tame Impala, MGMT, Foster the People',
            'Pop': 'Harry Styles, Miley Cyrus, Taylor Swift, Ed Sheeran',
            'R&B': 'The Weeknd, Frank Ocean, SZA, Bryson Tiller',
            'Rock': 'Queen, The Beatles, Led Zeppelin, The Rolling Stones',
            'Industrial Metal': 'Rammstein, Nine Inch Nails, Ministry, Marilyn Manson'
        };
        return artistsMap[genre] || '—Å—Ö–æ–∂–∏–µ –ø–æ —Å—Ç–∏–ª—é –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏';
    }

    // ==================== –ò–ù–¢–ï–†–§–ï–ô–°–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================

    function updateStatus(text, state) {
        const statusDot = document.getElementById('neuralStatus');
        const statusText = document.getElementById('statusText');
        
        statusText.textContent = text;
        statusDot.className = 'status-dot';
        
        if (state === 'active') {
            statusDot.style.background = 'var(--success)';
        } else if (state === 'error') {
            statusDot.style.background = 'var(--danger)';
        } else if (state === 'warning') {
            statusDot.style.background = 'var(--warning)';
        }
    }

    function addMessageToChat(text, sender, messageId = null) {
        const chat = document.getElementById('chatMessages');
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${sender}`;
        
        // –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω ID, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –µ–≥–æ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è
        if (messageId) {
            messageDiv.id = messageId;
            messageDiv.setAttribute('data-message-id', messageId);
        }
        
        const senderDiv = document.createElement('div');
        senderDiv.className = 'message-sender';
        
        if (sender === 'ai') {
            senderDiv.innerHTML = `<i class="fas fa-robot"></i> –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ò–ò`;
        } else {
            senderDiv.innerHTML = `<i class="fas fa-user"></i> –í—ã`;
        }
        
        const contentDiv = document.createElement('div');
        contentDiv.className = 'message-content';
        
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç: —É–±–∏—Ä–∞–µ–º –≤—Å–µ –≤–∏–¥—ã –∑–∞—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è –∏ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ–º HTML
        let processedText = text
            // –£–±–∏—Ä–∞–µ–º markdown –∑–∞—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ (~~—Ç–µ–∫—Å—Ç~~)
            .replace(/~~(.*?)~~/g, '$1')
            // –£–±–∏—Ä–∞–µ–º HTML —Ç–µ–≥–∏ –∑–∞—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è
            .replace(/<s[^>]*>(.*?)<\/s>/gi, '$1')
            .replace(/<del[^>]*>(.*?)<\/del>/gi, '$1')
            .replace(/<strike[^>]*>(.*?)<\/strike>/gi, '$1')
            // –£–±–∏—Ä–∞–µ–º Unicode —Å–∏–º–≤–æ–ª—ã –∑–∞—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è (U+0336, U+0335, U+0338)
            .replace(/[\u0336\u0335\u0338]/g, '')
            // –£–±–∏—Ä–∞–µ–º –≤—Å–µ HTML —Ç–µ–≥–∏ (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
            .replace(/<[^>]+>/g, '')
            // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º HTML —Å–∏–º–≤–æ–ª—ã
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#039;')
            // –ó–∞–º–µ–Ω—è–µ–º –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –Ω–∞ <br>
            .replace(/\n/g, '<br>');
        
        contentDiv.innerHTML = processedText;
        
        if (sender === 'ai') {
            const signature = document.createElement('div');
            signature.className = 'neural-signature';
            signature.innerHTML = `<i class="fas fa-cloud"></i> –û–Ω–ª–∞–π–Ω –ò–ò ‚Ä¢ –£–º–Ω—ã–π –ø–æ–∏—Å–∫`;
            contentDiv.appendChild(signature);
        }
        
        messageDiv.appendChild(senderDiv);
        messageDiv.appendChild(contentDiv);
        chat.appendChild(messageDiv);
        
        scrollChatToBottom();
        
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã
        return messageDiv;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
    function updateMessageInChat(messageId, newText) {
        const messageDiv = document.getElementById(messageId);
        if (messageDiv) {
            const contentDiv = messageDiv.querySelector('.message-content');
            if (contentDiv) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º signature –µ—Å–ª–∏ –µ—Å—Ç—å
                const signature = contentDiv.querySelector('.neural-signature');
                
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç: —É–±–∏—Ä–∞–µ–º –≤—Å–µ –≤–∏–¥—ã –∑–∞—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è –∏ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ–º HTML
                let processedText = newText
                    // –£–±–∏—Ä–∞–µ–º markdown –∑–∞—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ (~~—Ç–µ–∫—Å—Ç~~)
                    .replace(/~~(.*?)~~/g, '$1')
                    // –£–±–∏—Ä–∞–µ–º HTML —Ç–µ–≥–∏ –∑–∞—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è
                    .replace(/<s[^>]*>(.*?)<\/s>/gi, '$1')
                    .replace(/<del[^>]*>(.*?)<\/del>/gi, '$1')
                    .replace(/<strike[^>]*>(.*?)<\/strike>/gi, '$1')
                    // –£–±–∏—Ä–∞–µ–º Unicode —Å–∏–º–≤–æ–ª—ã –∑–∞—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è (U+0336, U+0335, U+0338)
                    .replace(/[\u0336\u0335\u0338]/g, '')
                    // –£–±–∏—Ä–∞–µ–º –≤—Å–µ HTML —Ç–µ–≥–∏ (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
                    .replace(/<[^>]+>/g, '')
                    // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º HTML —Å–∏–º–≤–æ–ª—ã
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#039;')
                    // –ó–∞–º–µ–Ω—è–µ–º –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –Ω–∞ <br>
                    .replace(/\n/g, '<br>');
                
                contentDiv.innerHTML = processedText;
                if (signature) {
                    contentDiv.appendChild(signature);
                }
                scrollChatToBottom();
            }
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
    function removeMessageFromChat(messageId) {
        const messageDiv = document.getElementById(messageId);
        if (messageDiv) {
            messageDiv.remove();
        }
    }
    
    // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ ai-core.js
    window.addMessageToChat = addMessageToChat;
    window.updateMessageInChat = updateMessageInChat;
    window.removeMessageFromChat = removeMessageFromChat;

    function showTypingIndicator(show) {
        // –£–±—Ä–∞–ª–∏ –ø–æ–∫–∞–∑ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π - —Ç–æ–ª—å–∫–æ —á–µ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç
        const sendBtn = document.getElementById('sendMessage');
        
        if (show) {
            sendBtn.disabled = true;
        } else {
            sendBtn.disabled = false;
        }
    }

    function scrollChatToBottom() {
        const chat = document.getElementById('chatMessages');
        chat.scrollTop = chat.scrollHeight;
    }


    // ==================== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ====================

    document.getElementById('sendMessage').addEventListener('click', sendMessageToNeural);
    
    document.getElementById('chatInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessageToNeural();
        }
    });

    // ==================== –ö–ù–û–ü–ö–ò –í–´–ë–û–†–ê –¢–ò–ü–ê –ü–û–ò–°–ö–ê ====================
    
    function setSearchType(type) {
        currentSearchType = type;
        
        // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
        document.querySelectorAll('.search-type-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–Ω–æ–ø–∫–µ
        const btn = document.querySelector(`[data-type="${type}"]`);
        if (btn) btn.classList.add('active');
        
        // –ú–µ–Ω—è–µ–º placeholder –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
        const placeholders = {
            melody: "–û–ø–∏—à–∏—Ç–µ –º–µ–ª–æ–¥–∏—é –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥ (–Ω–∞–ø–æ–π—Ç–µ)...",
            lyrics: "–í–≤–µ–¥–∏—Ç–µ —Å—Ç—Ä–æ—á–∫–∏ –∏–∑ –ø–µ—Å–Ω–∏ –∏–ª–∏ —Ç–µ–º—É —Ç–µ–∫—Å—Ç–∞...",
            mood: "–û–ø–∏—à–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: '–≥—Ä—É—Å—Ç–Ω—ã–π –æ—Å–µ–Ω–Ω–∏–π –≤–µ—á–µ—Ä')...",
            describe: "–û–ø–∏—à–∏—Ç–µ –∫–ª–∏–ø –∏–ª–∏ –∞—Ç–º–æ—Å—Ñ–µ—Ä—É (–Ω–∞–ø—Ä–∏–º–µ—Ä: '–Ω–µ–æ–Ω–æ–≤—ã–µ –æ–≥–Ω–∏, –Ω–æ—á–Ω–æ–π –≥–æ—Ä–æ–¥')..."
        };
        
        document.getElementById('chatInput').placeholder = placeholders[type] || "–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –æ –º—É–∑—ã–∫–µ...";
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –≤ —á–∞—Ç–µ
        if (type === 'melody') {
            addMessageToChat('üé§ **–†–µ–∂–∏–º –ø–æ–∏—Å–∫–∞ –ø–æ –Ω–∞–ø–µ–≤—É –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!**\n\n–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –∏ –Ω–∞–ø–æ–π—Ç–µ –º–µ–ª–æ–¥–∏—é, –∏–ª–∏ –æ–ø–∏—à–∏—Ç–µ –µ—ë —Å–ª–æ–≤–∞–º–∏.', 'ai');
        }
    }

    // ==================== –ì–û–õ–û–°–û–í–û–ô –í–í–û–î ====================
    
    // ==================== –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ì–û–õ–û–°–û–í–û–ô –í–í–û–î ====================
    
    function toggleVoiceInput() {
        if (!window.aiCore) {
            addMessageToChat('‚ùå AI Core –Ω–µ –Ω–∞–π–¥–µ–Ω', 'ai');
            return;
        }
        
        const voiceBtn = document.getElementById('voiceButton');
        const voiceStatus = document.getElementById('voiceStatus');
        
        if (!isVoiceListening) {
            // --- –í–ö–õ–Æ–ß–ê–ï–ú –ú–ò–ö–†–û–§–û–ù ---
            window.aiCore.startVoiceInput();
            isVoiceListening = true;
            
            // –ö—Ä–∞—Å–∏–º –∫–Ω–æ–ø–∫—É –≤ –∫—Ä–∞—Å–Ω—ã–π
            voiceBtn.classList.add('listening');
            voiceBtn.innerHTML = '<i class="fas fa-stop"></i>'; 
            if (voiceStatus) {
                voiceStatus.classList.add('active');
                voiceStatus.style.display = 'block';
            }
        } else {
            // --- –†–£–ß–ù–û–ï –í–´–ö–õ–Æ–ß–ï–ù–ò–ï ---
            stopVoiceUI(); // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é —Å–±—Ä–æ—Å–∞ (—Å–º. –Ω–∏–∂–µ)
            window.aiCore.stopVoiceInput();
        }
    }

    // –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –≥–∞—Å–∏—Ç –∫–Ω–æ–ø–∫—É (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é –ò–õ–ò –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
    function stopVoiceUI() {
        const voiceBtn = document.getElementById('voiceButton');
        const voiceStatus = document.getElementById('voiceStatus');
        
        isVoiceListening = false;
        
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–µ—Ä—ã–π —Ü–≤–µ—Ç –∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω
        if (voiceBtn) {
            voiceBtn.classList.remove('listening');
            voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
        }
        if (voiceStatus) {
            voiceStatus.classList.remove('active');
            voiceStatus.style.display = 'none';
        }
    }

    // üî• –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –í–´–ö–õ–Æ–ß–ï–ù–ò–ï –ü–û–°–õ–ï –§–†–ê–ó–´ üî•
    // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ç–æ—Ç "–ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫" –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    document.addEventListener('DOMContentLoaded', () => {
        setTimeout(() => {
            if (window.aiCore) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É
                const originalHandler = window.aiCore.onVoiceInput.bind(window.aiCore);
                
                // –°—Ç–∞–≤–∏–º —Å–≤–æ—é: –°–Ω–∞—á–∞–ª–∞ –≥–∞—Å–∏–º –∫–Ω–æ–ø–∫—É -> –ü–æ—Ç–æ–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç
                window.aiCore.onVoiceInput = function(text) {
                    console.log("üé§ –§—Ä–∞–∑–∞ –ø–æ–π–º–∞–Ω–∞, –≥–∞—à—É –∫–Ω–æ–ø–∫—É...");
                    stopVoiceUI(); // <--- –í–û–¢ –≠–¢–û –í–´–ö–õ–Æ–ß–ò–¢ –ö–ù–û–ü–ö–£ –°–ê–ú–û
                    originalHandler(text); // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ —á–∞—Ç
                };
            }
        }, 1000);
    });
    // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º
    async function sendMessageToNeuralWithPrompt(prompt, searchType = null) {
        showTypingIndicator(true);
        
        try {
            const response = await callPublicAI(prompt);
            addMessageToChat(response, 'ai');
            
            // –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ai-core, –ø–µ—Ä–µ–¥–∞–µ–º searchType
            if (window.aiCore && searchType) {
                // ai-core —Å–∞–º –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç MusicBrainz –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ API:', error);
            const errorMessage = `‚ùå **–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ AI:**\n\n${error.message}\n\n` +
                               `üí° **–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**\n` +
                               `‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É\n` +
                               `‚Ä¢ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ API –∫–ª—é—á –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π\n` +
                               `‚Ä¢ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É\n\n` +
                               `üîß –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.`;
            addMessageToChat(errorMessage, 'ai');
            updateStatus('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'error');
        } finally {
            showTypingIndicator(false);
            scrollChatToBottom();
        }
    }


    // ==================== –ë–´–°–¢–†–´–ï –î–ï–ô–°–¢–í–ò–Ø ====================
    
    function quickSearch(query) {
        document.getElementById('chatInput').value = query;
        sendMessageToNeural();
    }

    // ==================== –ü–û–°–õ–ï–î–ù–ò–ï –ù–ê–•–û–î–ö–ò ====================
    
    function addRecentFind(trackName, artist) {
        const recentFinds = document.getElementById('recentFinds');
        let finds = JSON.parse(localStorage.getItem('musicAI_recentFinds') || '[]');
        
        finds.unshift({ track: trackName, artist: artist, time: Date.now() });
        finds = finds.slice(0, 5); // –•—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5
        
        localStorage.setItem('musicAI_recentFinds', JSON.stringify(finds));
        updateRecentFinds();
    }
    
    function updateRecentFinds() {
        const recentFinds = document.getElementById('recentFinds');
        const finds = JSON.parse(localStorage.getItem('musicAI_recentFinds') || '[]');
        
        if (finds.length === 0) {
            recentFinds.innerHTML = '<p style="color: var(--gray); font-size: 0.9rem;">–ü–æ–∫–∞ –Ω–µ—Ç –Ω–∞—Ö–æ–¥–æ–∫</p>';
            return;
        }
        
        recentFinds.innerHTML = finds.map(f => 
            `<div class="recent-find-item">üéµ ${f.track} - ${f.artist}</div>`
        ).join('');
    }

    // –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π
    window.sendMessageToNeural = sendMessageToNeural;
    window.setSearchType = setSearchType;
    window.toggleVoiceInput = toggleVoiceInput;
    window.quickSearch = quickSearch;
    </script>

<style>
    /* 1. –í—ã—Ç–∞—Å–∫–∏–≤–∞–µ–º –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–∞ —Å–∞–º—ã–π –≤–µ—Ä—Ö */
    #settingsModal {
        z-index: 2147483647 !important; 
    }

    /* 2. –î–µ–ª–∞–µ–º –∫–Ω–æ–ø–∫—É –∏ –ø–æ–ª–µ –≤–≤–æ–¥–∞ "–Ω–µ–ø—Ä–æ–±–∏–≤–∞–µ–º—ã–º–∏" –¥–ª—è –ø–∞–ª—å—Ü–∞ */
    #saveApiKeyBtn, #googleApiKeyInput {
        position: relative !important;
        z-index: 2147483648 !important; 
        pointer-events: auto !important;
        cursor: pointer !important;
        touch-action: manipulation !important; /* –£–±–∏—Ä–∞–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É –Ω–∞–∂–∞—Ç–∏—è */
    }

    /* 3. –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ */
    #googleApiKeyInput {
        font-size: 16px !important; /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∑—É–º –Ω–∞ iOS */
    }

    @media (max-width: 768px) {
        #googleApiKeyInput {
            font-size: 16px !important;
        }
    }
</style>

<script>
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    function showApiKeyModal() {
        const modal = document.getElementById('settingsModal');
        if (modal) {
            console.log("üîß –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ–∫–∞–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞...");
            modal.classList.remove('hidden');
            modal.classList.add('show');
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ —Å—Ç–∏–ª–∏
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.display = 'flex';
            modal.style.opacity = '1';
            modal.style.pointerEvents = 'all';
            modal.style.visibility = 'visible';
            modal.style.zIndex = '2147483647';
            modal.style.background = 'rgba(15, 23, 42, 0.95)';
            modal.style.backdropFilter = 'blur(15px)';
            modal.style.justifyContent = 'center';
            modal.style.alignItems = 'center';
            
            console.log("‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∫–∞–∑–∞–Ω–æ. –°—Ç–∏–ª–∏:", {
                display: modal.style.display,
                opacity: modal.style.opacity,
                zIndex: modal.style.zIndex,
                visibility: modal.style.visibility
            });
            
            return true;
        } else {
            console.error("‚ùå –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!");
        }
        return false;
    }

    // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
    window.showApiKeyModal = showApiKeyModal;

    document.addEventListener('DOMContentLoaded', () => {
        console.log("üì± –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ API –∫–ª—é—á–∞...");

        const modal = document.getElementById('settingsModal');
        const saveBtn = document.getElementById('saveApiKeyBtn');
        const apiInput = document.getElementById('googleApiKeyInput');

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        console.log("üîç –≠–ª–µ–º–µ–Ω—Ç—ã:", {
            modal: !!modal,
            saveBtn: !!saveBtn,
            apiInput: !!apiInput
        });

        // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–ª—é—á–∞
        function saveApiKey() {
            const key = apiInput ? apiInput.value.trim() : "";

            if (!key || key.length < 10) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –≤–∏–∑—É–∞–ª—å–Ω–æ
                if (apiInput) {
                    apiInput.style.borderColor = '#ef4444';
                    apiInput.placeholder = "‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π API –∫–ª—é—á";
                    setTimeout(() => {
                        apiInput.style.borderColor = '';
                        apiInput.placeholder = "AIzaSy...";
                    }, 2000);
                }
                // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                if (apiInput) {
                    apiInput.focus();
                }
                return false;
            }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª—é—á –≤ window.currentApiKey (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏)
            // –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∏—Ç—Å—è, –∏ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ—è–≤–∏—Ç—Å—è —Å–Ω–æ–≤–∞
            try {
                window.currentApiKey = key;
                console.log("‚úÖ API –∫–ª—é—á —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–∏—Å—á–µ–∑–Ω–µ—Ç –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ)");

                // –û–±–Ω–æ–≤–ª—è–µ–º AI Core —Å –Ω–æ–≤—ã–º –∫–ª—é—á–æ–º
                if (window.aiCore) {
                    if (!window.aiCore.apiKeys || window.aiCore.apiKeys.length === 0) {
                        window.aiCore.apiKeys = [key];
                    } else {
                        // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª—é—á –≤ –Ω–∞—á–∞–ª–æ —Å–ø–∏—Å–∫–∞ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
                        if (!window.aiCore.apiKeys.includes(key)) {
                            window.aiCore.apiKeys.unshift(key); // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ
                        } else {
                            // –ï—Å–ª–∏ –∫–ª—é—á —É–∂–µ –µ—Å—Ç—å, –ø–µ—Ä–µ–º–µ—â–∞–µ–º –µ–≥–æ –≤ –Ω–∞—á–∞–ª–æ
                            const index = window.aiCore.apiKeys.indexOf(key);
                            window.aiCore.apiKeys.splice(index, 1);
                            window.aiCore.apiKeys.unshift(key);
                        }
                    }
                    window.aiCore.currentKeyIndex = 0;
                    console.log(`‚úÖ AI Core –æ–±–Ω–æ–≤–ª–µ–Ω. –ö–ª—é—á–µ–π: ${window.aiCore.apiKeys.length}`);
                    console.log(`   –ü–µ—Ä–≤—ã–π –∫–ª—é—á: ${window.aiCore.apiKeys[0].substring(0, 20)}...`);
                }

                // –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ "–¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞" –∏–∑ —á–∞—Ç–∞
                const chatMessages = document.getElementById('chatMessages');
                if (chatMessages) {
                    const messages = chatMessages.querySelectorAll('.message.ai');
                    messages.forEach(msg => {
                        const content = msg.querySelector('.message-content');
                        if (content && (content.textContent.includes('–¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞') || 
                                       content.textContent.includes('–Ω–µ –Ω–∞—à–µ–ª API –∫–ª—é—á'))) {
                            msg.remove();
                        }
                    });
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                updateStatus('‚úÖ API –∫–ª—é—á —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω', 'active');

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö
                if (saveBtn) {
                    const originalText = saveBtn.innerHTML;
                    saveBtn.innerHTML = '<i class="fas fa-check"></i> <span>–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!</span>';
                    saveBtn.style.background = 'linear-gradient(90deg, #10b981, #059669)';

                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
                    setTimeout(() => {
                        if (modal) {
                            modal.classList.add('hidden');
                            modal.style.opacity = '0';
                            
                            // –ù–ï –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É - –∫–ª—é—á —É–∂–µ –≤ sessionStorage, –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–∫—Ä–æ–µ—Ç—Å—è
                            // –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ (F5) sessionStorage –æ—á–∏—Å—Ç–∏—Ç—Å—è –∏ –æ–∫–Ω–æ –ø–æ—è–≤–∏—Ç—Å—è —Å–Ω–æ–≤–∞
                        }
                    }, 500);
                }
                return true;
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–ª—é—á–∞:", e);
                alert("‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.");
                return false;
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        if (saveBtn) {
            // –ö–ª–∏–∫ –º—ã—à–∏
            saveBtn.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                saveApiKey();
            });

            // –¢–∞—á-—Å–æ–±—ã—Ç–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
            saveBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                e.stopPropagation();
                saveApiKey();
            }, { passive: false });

            // –ù–∞–∂–∞—Ç–∏–µ Enter –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
            if (apiInput) {
                apiInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        saveApiKey();
                    }
                });
            }
        }

        // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ (–¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö)
        if (apiInput) {
            // –¢–∞—á-—Å–æ–±—ã—Ç–∏–µ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
            apiInput.addEventListener('touchstart', function(e) {
                e.stopPropagation();
                this.focus();
                // –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –∑–∞–¥–µ—Ä–∂–∫–∞
                setTimeout(() => {
                    this.focus();
                }, 100);
            }, { passive: false });

            // –ö–ª–∏–∫ —Ç–æ–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º
            apiInput.addEventListener('click', function(e) {
                e.stopPropagation();
                this.focus();
            });
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ, –Ω—É–∂–Ω–æ –ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        const checkAndShowModal = () => {
            // –í—Å–µ–≥–¥–∞ –æ—á–∏—â–∞–µ–º localStorage - –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –∫–ª—é—á
            localStorage.removeItem('music_ai_google_key');
            const savedKey = null; // –í—Å–µ–≥–¥–∞ null - –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –∫–ª—é—á
            let hasValidKey = false;

            if (false && savedKey) { // –í—Å–µ–≥–¥–∞ false - –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –∫–ª—é—á
                try {
                    let parsedKey = JSON.parse(savedKey);
                    if (typeof parsedKey === 'string' && parsedKey.startsWith('"')) {
                        parsedKey = JSON.parse(parsedKey);
                    }
                    if (parsedKey && typeof parsedKey === 'string' && parsedKey.length >= 20) {
                        hasValidKey = true;
                        console.log("‚úÖ –í–∞–ª–∏–¥–Ω—ã–π –∫–ª—é—á –Ω–∞–π–¥–µ–Ω –≤ localStorage");
                    }
                } catch (e) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–ª—é—á–∞:", e);
                }
            }

            if (!hasValidKey) {
                console.log("‚ö†Ô∏è –ö–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ localStorage, –ø–æ–∫–∞–∑—ã–≤–∞—é –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ");
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
                if (modal) {
                    // –°–ø–æ—Å–æ–± 1: —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é
                    showApiKeyModal();
                    
                    // –°–ø–æ—Å–æ–± 2: –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ —Å—Ç–∏–ª–∏ (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞)
                    setTimeout(() => {
                        if (modal.classList.contains('hidden')) {
                            console.log("üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞...");
                            modal.classList.remove('hidden');
                            modal.classList.add('show');
                            modal.style.cssText = `
                                position: fixed !important;
                                top: 0 !important;
                                left: 0 !important;
                                width: 100vw !important;
                                height: 100vh !important;
                                display: flex !important;
                                opacity: 1 !important;
                                pointer-events: all !important;
                                visibility: visible !important;
                                z-index: 2147483647 !important;
                                background: rgba(15, 23, 42, 0.95) !important;
                                backdrop-filter: blur(15px) !important;
                                justify-content: center !important;
                                align-items: center !important;
                            `;
                        }
                        
                        // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                        if (apiInput) {
                            apiInput.focus();
                            console.log("‚úÖ –§–æ–∫—É—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞");
                        }
                    }, 300);
                } else {
                    console.error("‚ùå –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ DOM!");
                }
            } else {
                console.log("‚úÖ –ö–ª—é—á –Ω–∞–π–¥–µ–Ω, –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º");
            }
        };

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–∞–∑—É –∏ —á–µ—Ä–µ–∑ –∑–∞–¥–µ—Ä–∂–∫–∏ (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –µ—â–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è)
        checkAndShowModal();
        setTimeout(checkAndShowModal, 500);
        setTimeout(checkAndShowModal, 1500);
        setTimeout(checkAndShowModal, 3000);

        // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞, –∫–æ–≥–¥–∞ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
        const observer = new MutationObserver(() => {
            if (modal && !modal.classList.contains('hidden')) {
                setTimeout(() => {
                    if (apiInput) {
                        apiInput.focus();
                        // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –ø–æ–ª—é –≤–≤–æ–¥–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
                        if (window.innerWidth <= 768) {
                            apiInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    }
                }, 500);
            }
        });

        if (modal) {
            observer.observe(modal, {
                attributes: true,
                attributeFilter: ['class', 'style']
            });

            // –ï—Å–ª–∏ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–∂–µ –æ—Ç–∫—Ä—ã—Ç–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            if (!modal.classList.contains('hidden')) {
                setTimeout(() => {
                    if (apiInput) {
                        apiInput.focus();
                    }
                }, 500);
            }
        }

        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ñ–æ–Ω
        if (modal) {
            modal.addEventListener('click', (e) => {
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –Ω–∞ —Å–∞–º —Ñ–æ–Ω (–Ω–µ –Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç)
                if (e.target === modal) {
                    e.stopPropagation();
                    // –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º - –∫–ª—é—á –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã
                }
            });

            // –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —Ç–æ–∂–µ
            modal.addEventListener('touchstart', (e) => {
                if (e.target === modal) {
                    e.stopPropagation();
                }
            }, { passive: false });

            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç
            const modalContent = modal.querySelector('.settings-content');
            if (modalContent) {
                modalContent.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
            }
        }
    });
</script>
</body>
</html>




