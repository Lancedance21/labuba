<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script>
        // –ï—Å–ª–∏ keys.js –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –ø—É—Å—Ç—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, —á—Ç–æ–±—ã —Å–∞–π—Ç –Ω–µ —É–º–µ—Ä
        window.GOOGLE_API_KEYS = []; 
        window.CONFIG = { GOOGLE_AI: { API_KEYS: [] } };
        console.log("üöë –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∫–ª—é—á–µ–π –≤–∫–ª—é—á–µ–Ω–∞");
    </script>
    
    <script src="keys.js?v=2.0" onerror="console.log('GitHub —Ä–µ–∂–∏–º: keys.js –ø—Ä–æ–ø—É—â–µ–Ω')"></script>
    <script src="config.js?v=2.0"></script>
    <script src="api/musicbrainz.js"></script>
    <script src="ai-core.js?v=2.0"></script>
    <link rel="stylesheet" href="styles/custom.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéµ –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ò–ò —Å –Ω–µ–π—Ä–æ—Å–µ—Ç—å—é | –ë–µ—Å–ø–ª–∞—Ç–Ω–æ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Transformers.js –¥–ª—è –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ -->
    <script src="https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.0"></script>
    <style>
        /* –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –º—É–∑—ã–∫–∞–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        :root {
            --primary: #6366f1;
            --secondary: #8b5cf6;
            --accent: #06b6d4;
            --dark: #0f172a;
            --darker: #020617;
            --light: #f1f5f9;
            --gray: #94a3b8;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
            --gradient2: linear-gradient(135deg, var(--accent), var(--primary));
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            --glow: 0 0 30px rgba(99, 102, 241, 0.3);
        }

        body {
            background: var(--darker);
            color: var(--light);
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(6, 182, 212, 0.1) 0%, transparent 50%),
                linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 10% 20%, rgba(99, 102, 241, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 40%);
            pointer-events: none;
            z-index: 0;
            animation: backgroundShift 20s ease-in-out infinite;
        }

        @keyframes backgroundShift {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.1); }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        @keyframes slideIn {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes neuralGlow {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(99, 102, 241, 0.3),
                            inset 0 0 20px rgba(99, 102, 241, 0.1);
            }
            50% { 
                box-shadow: 0 0 40px rgba(99, 102, 241, 0.5),
                            inset 0 0 30px rgba(99, 102, 241, 0.2);
            }
        }

        @keyframes thinking {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            animation: slideIn 0.8s ease-out;
            position: relative;
            z-index: 1;
        }

        /* –•–µ–¥–µ—Ä */
        .header {
            text-align: center;
            padding: 50px 20px;
            position: relative;
        }

        .neural-badge {
            display: inline-block;
            background: var(--gradient);
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 1.2rem;
            margin-bottom: 30px;
            animation: pulse 2s infinite;
            border: 2px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        h1 {
            font-size: 4rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 20px;
            text-shadow: 0 0 50px rgba(99, 102, 241, 0.3);
            animation: float 3s ease-in-out infinite;
        }

        .subtitle {
            font-size: 1.4rem;
            color: var(--gray);
            max-width: 800px;
            margin: 0 auto 40px;
            line-height: 1.6;
        }

        /* –ù–µ–π—Ä–æ—Å–µ—Ç—å —Å—Ç–∞—Ç—É—Å */
        .neural-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid var(--glass-border);
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }

        .status-dot.thinking {
            background: var(--warning);
            animation: thinking 1s infinite;
        }

        /* –û—Å–Ω–æ–≤–Ω–∞—è —Å–µ—Ç–∫–∞ */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 50px;
        }

        @media (max-width: 1100px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.02) 100%);
            backdrop-filter: blur(30px);
            border-radius: 30px;
            padding: 35px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(255, 255, 255, 0.05) inset,
                0 0 100px rgba(99, 102, 241, 0.1);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, 
                var(--primary) 0%, 
                var(--secondary) 50%, 
                var(--accent) 100%);
            background-size: 200% 100%;
            animation: gradientShift 3s ease infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .card::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none;
        }

        .card:hover {
            transform: translateY(-8px) scale(1.01);
            box-shadow: 
                0 30px 80px rgba(0, 0, 0, 0.4),
                0 0 0 1px rgba(255, 255, 255, 0.1) inset,
                0 0 150px rgba(99, 102, 241, 0.2);
            border-color: rgba(99, 102, 241, 0.4);
        }

        .card:hover::after {
            opacity: 1;
        }

        .card.neural-core {
            animation: neuralGlow 3s infinite;
            border: 2px solid rgba(99, 102, 241, 0.2);
        }

        .card-title {
            font-size: 2rem;
            color: var(--light);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .card-title i {
            font-size: 2.2rem;
            color: var(--accent);
        }

        /* –ß–∞—Ç —Å –Ω–µ–π—Ä–æ—Å–µ—Ç—å—é */
        .chat-container {
            height: 600px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.2) 100%);
            border-radius: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 10px;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--secondary), var(--accent));
        }

        /* –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ –±–æ–∫–∞–º */
        .side-decoration {
            position: fixed;
            top: 0;
            width: 200px;
            height: 100vh;
            pointer-events: none;
            z-index: 1;
        }

        .side-decoration.left {
            left: 0;
        }

        .side-decoration.right {
            right: 0;
        }

        .floating-element {
            position: absolute;
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
            border-radius: 50%;
            filter: blur(40px);
            animation: floatSide 8s ease-in-out infinite;
            opacity: 0.6;
        }

        @keyframes floatSide {
            0%, 100% { 
                transform: translateX(0) translateY(0) scale(1);
                opacity: 0.6;
            }
            25% { 
                transform: translateX(30px) translateY(-20px) scale(1.2);
                opacity: 0.8;
            }
            50% { 
                transform: translateX(-20px) translateY(30px) scale(0.8);
                opacity: 0.4;
            }
            75% { 
                transform: translateX(20px) translateY(20px) scale(1.1);
                opacity: 0.7;
            }
        }

        /* –ë–æ–∫–æ–≤—ã–µ –ø–∞–Ω–µ–ª–∏ */
        .side-panel {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            width: 180px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.03) 100%);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            z-index: 5;
            transition: all 0.4s ease;
        }

        .side-panel.left-panel {
            left: 20px;
        }

        .side-panel.right-panel {
            right: 20px;
        }

        .side-panel:hover {
            transform: translateY(-50%) scale(1.05);
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.4);
        }

        .panel-content h3 {
            font-size: 1.1rem;
            margin-bottom: 20px;
            color: var(--light);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-content h3 i {
            color: var(--primary);
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .genre-tag {
            display: inline-block;
            padding: 8px 15px;
            margin: 5px 5px 5px 0;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 15px;
            font-size: 0.85rem;
            color: var(--light);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .genre-tag:hover {
            background: var(--gradient);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.4);
        }

        /* –ì–ª–∞–≤–Ω—ã–π layout */
        .main-layout {
            display: grid;
            grid-template-columns: 280px 1fr 280px;
            gap: 20px;
            min-height: 100vh;
            padding: 20px;
            max-width: 1800px;
            margin: 0 auto;
        }

        @media (max-width: 1400px) {
            .main-layout {
                grid-template-columns: 250px 1fr 250px;
            }
        }

        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 220px 1fr;
            }
            .right-sidebar {
                display: none;
            }
        }

        @media (max-width: 900px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            .left-sidebar {
                display: none;
            }
        }

        /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */
        .sidebar {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.03) 100%);
            backdrop-filter: blur(30px);
            border-radius: 25px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            height: fit-content;
            position: sticky;
            top: 20px;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }

        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: var(--gradient);
            border-radius: 10px;
        }

        .sidebar-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            font-size: 0.85rem;
        }

        .sidebar-section {
            margin-bottom: 30px;
        }

        .sidebar-section h3 {
            font-size: 1rem;
            color: var(--light);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-section h3 i {
            color: var(--primary);
        }

        .search-type-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .search-type-btn {
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            color: var(--light);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.9rem;
            text-align: left;
        }

        .search-type-btn:hover {
            background: rgba(99, 102, 241, 0.2);
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .search-type-btn.active {
            background: var(--gradient);
            border-color: transparent;
            color: white;
        }

        .search-type-btn i {
            font-size: 1.2rem;
            width: 20px;
        }


        /* –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —á–∞—Ç */
        .main-chat-container {
            display: flex;
            flex-direction: column;
        }

        .chat-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            backdrop-filter: blur(30px);
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            height: calc(100vh - 100px);
            max-height: none;
            min-height: 900px;
            overflow: hidden;
        }

        .chat-header {
            padding: 20px 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.2);
        }

        .chat-header h2 {
            font-size: 1.5rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            min-height: 0;
        }

        .voice-status {
            text-align: center;
            margin-top: 10px;
            color: var(--gray);
            font-size: 0.9rem;
            display: none;
            padding: 10px;
            background: rgba(239, 68, 68, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .voice-status.active {
            display: block;
        }

        .voice-status i {
            color: var(--danger);
            animation: pulse 1s infinite;
            margin-right: 8px;
        }

        /* –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è */
        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quick-btn {
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: var(--light);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 0.9rem;
        }

        .quick-btn:hover {
            background: rgba(99, 102, 241, 0.2);
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .recent-finds {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .recent-find-item {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: var(--light);
        }

        .recent-find-item:last-child {
            border-bottom: none;
        }

        /* –®–∞–ø–∫–∞ —Å–∞–π—Ç–∞ */
        .site-header {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.15) 100%);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 25px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
        }

        .header-content {
            max-width: 1800px;
            margin: 0 auto;
            padding: 0 30px;
            text-align: center;
        }

        .site-title {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #06b6d4 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 8px;
            letter-spacing: -1px;
            text-shadow: 0 0 80px rgba(99, 102, 241, 0.5);
            animation: float 4s ease-in-out infinite;
        }

        .header-subtitle {
            font-size: 0.95rem;
            color: var(--gray);
            font-weight: 500;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        @media (max-width: 768px) {
            .site-title {
                font-size: 1.8rem;
            }
            .header-subtitle {
                font-size: 0.8rem;
            }
        }

        .message {
            margin-bottom: 25px;
            animation: slideIn 0.3s ease-out;
        }

        .message.ai .message-content {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.15) 100%);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 20px 20px 20px 5px;
            padding: 20px;
            position: relative;
            backdrop-filter: blur(10px);
            box-shadow: 0 5px 20px rgba(99, 102, 241, 0.2);
            text-decoration: none !important; /* –£–±–∏—Ä–∞–µ–º –∑–∞—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ */
        }
        
        .message.ai .message-content,
        .message.ai .message-content *,
        .message.ai .message-content *::before,
        .message.ai .message-content *::after {
            text-decoration: none !important; /* –£–±–∏—Ä–∞–µ–º –∑–∞—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ –≤–µ–∑–¥–µ */
            text-decoration-line: none !important;
            text-decoration-style: none !important;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.2) 0%, rgba(99, 102, 241, 0.15) 100%);
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 20px 20px 5px 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 5px 20px rgba(6, 182, 212, 0.2);
        }

        .message-sender {
            font-size: 0.95rem;
            color: var(--accent);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .neural-signature {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* –í–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è */
        .chat-input-container {
            display: flex;
            gap: 15px;
            position: relative;
            align-items: center;
        }

        .voice-btn {
            padding: 15px 20px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 15px;
            color: var(--light);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 50px;
            position: relative;
            overflow: hidden;
            margin-left: 15px;
        }

        .voice-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
        }

        .voice-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .voice-btn:hover {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.4) 0%, rgba(139, 92, 246, 0.4) 100%);
            border-color: var(--primary);
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(99, 102, 241, 0.5);
        }

        .voice-btn.listening {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            border-color: var(--danger);
            animation: voicePulse 1.5s ease-in-out infinite;
            box-shadow: 0 0 40px rgba(239, 68, 68, 0.6);
        }

        @keyframes voicePulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 40px rgba(239, 68, 68, 0.6);
            }
            50% { 
                transform: scale(1.1);
                box-shadow: 0 0 60px rgba(239, 68, 68, 0.9);
            }
        }

        .search-type-btn {
            padding: 20px 25px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            color: var(--light);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
            font-weight: 500;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .search-type-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .search-type-btn:hover::before {
            left: 100%;
        }

        .search-type-btn:hover {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
            border-color: rgba(99, 102, 241, 0.5);
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }

        .search-type-btn.active {
            background: var(--gradient);
            border-color: transparent;
            color: white;
            box-shadow: 0 10px 40px rgba(99, 102, 241, 0.4);
            transform: translateY(-3px) scale(1.03);
        }

        .search-type-btn i {
            font-size: 2rem;
            color: var(--primary);
            transition: all 0.3s ease;
            filter: drop-shadow(0 0 10px rgba(99, 102, 241, 0.5));
        }

        .search-type-btn:hover i {
            transform: scale(1.2) rotate(5deg);
            filter: drop-shadow(0 0 15px rgba(99, 102, 241, 0.8));
        }

        .search-type-btn.active i {
            color: white;
            filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.8));
        }

        #chatInput {
            flex: 1;
            padding: 20px 25px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.03) 100%);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            color: var(--light);
            font-size: 1.1rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
        }

        #chatInput:focus {
            outline: none;
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.12) 0%, rgba(255, 255, 255, 0.05) 100%);
            box-shadow: 
                0 0 30px rgba(99, 102, 241, 0.4),
                0 0 0 3px rgba(99, 102, 241, 0.1);
            transform: scale(1.02);
        }

        #sendMessage {
            padding: 18px 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            border: none;
            border-radius: 50px;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 700;
            min-width: 200px;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 15px 35px rgba(102, 126, 234, 0.4),
                0 5px 15px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        #sendMessage::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: rotate(45deg);
            transition: left 0.6s ease;
        }

        #sendMessage:hover:not(:disabled)::before {
            left: 100%;
        }

        #sendMessage::after {
            content: '‚ú®';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            opacity: 0;
            transition: all 0.4s ease;
        }

        #sendMessage:hover:not(:disabled) {
            transform: scale(1.08) translateY(-3px);
            box-shadow: 
                0 25px 50px rgba(102, 126, 234, 0.6),
                0 10px 20px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            background: linear-gradient(135deg, #764ba2 0%, #f093fb 50%, #667eea 100%);
        }

        #sendMessage:hover:not(:disabled)::after {
            opacity: 0.3;
            animation: sparkle 1s ease infinite;
        }

        #sendMessage:active:not(:disabled) {
            transform: scale(0.95);
        }

        @keyframes sparkle {
            0%, 100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
            50% { transform: translate(-50%, -50%) scale(1.5) rotate(180deg); }
        }

        #sendMessage:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* –ü–æ–∏—Å–∫ –º—É–∑—ã–∫–∏ */
        .search-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .search-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
        }

        .search-card:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--glass-border);
            transform: translateY(-5px);
        }

        .search-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .search-title {
            font-size: 1.3rem;
            color: var(--light);
            margin-bottom: 10px;
        }

        .search-desc {
            color: var(--gray);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        /* –ù–µ–π—Ä–æ—Å–µ—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è */
        .neural-info {
            background: rgba(99, 102, 241, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .model-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .model-badge {
            background: var(--gradient);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* –ó–∞–≥—Ä—É–∑–∫–∞ */
        .loading {
            text-align: center;
            padding: 50px;
        }

        .neural-spinner {
            width: 70px;
            height: 70px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid var(--primary);
            border-right: 4px solid var(--secondary);
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
            margin: 0 auto 25px;
            position: relative;
        }

        .neural-spinner::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            border: 2px solid rgba(99, 102, 241, 0.2);
            border-radius: 50%;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞ - —É–±—Ä–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —á–µ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç */

        /* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */
        .results-section {
            margin: 50px 0;
        }

        .section-title {
            font-size: 2.5rem;
            color: var(--light);
            margin-bottom: 35px;
            text-align: center;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }

        .song-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid var(--glass-border);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .song-card:hover {
            transform: translateY(-8px);
            border-color: var(--primary);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .song-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient);
        }

        .song-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .song-avatar {
            width: 60px;
            height: 60px;
            background: var(--gradient);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
        }

        .song-info h3 {
            font-size: 1.4rem;
            color: var(--light);
            margin-bottom: 5px;
        }

        .song-info p {
            color: var(--accent);
            font-size: 1.1rem;
        }

        .song-features {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }

        .feature-tag {
            background: rgba(99, 102, 241, 0.1);
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: var(--primary);
        }

        .neural-match {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--glass-border);
        }

        .match-score {
            font-size: 1.8rem;
            font-weight: 800;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        /* –§—É—Ç–µ—Ä */
        footer {
            text-align: center;
            padding: 50px 20px;
            margin-top: 80px;
            border-top: 1px solid var(--glass-border);
            color: var(--gray);
            font-size: 0.95rem;
        }

        .tech-stack {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .tech-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 25px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            border: 1px solid var(--glass-border);
        }

        /* –£—Ç–∏–ª–∏—Ç—ã */
        .hidden {
            display: none;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        .neuron {
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, var(--primary), transparent);
            border-radius: 50%;
            position: absolute;
            opacity: 0.1;
            animation: float 6s infinite ease-in-out;
        }

        .neuron:nth-child(1) { top: 10%; left: 5%; animation-delay: 0s; }
        .neuron:nth-child(2) { top: 20%; right: 10%; animation-delay: 1s; }
        .neuron:nth-child(3) { bottom: 30%; left: 15%; animation-delay: 2s; }
    </style>
</head>
<body>
    
    <!-- –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–µ–π—Ä–æ–Ω—ã -->
    <div class="neuron"></div>
    <div class="neuron"></div>
    <div class="neuron"></div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤–≤–æ–¥–∞ API –∫–ª—é—á–∞ -->
    <div id="settingsModal" class="settings-modal hidden">
        <div class="settings-content">
            <div class="modal-icon">
                <i class="fas fa-key"></i>
            </div>
            <h2 class="settings-title">–¢—Ä–µ–±—É–µ—Ç—Å—è API –∫–ª—é—á</h2>
            <p class="settings-desc">–í–≤–µ–¥–∏—Ç–µ –≤–∞—à Google AI API –∫–ª—é—á –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ö–ª—é—á —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–∞–º–∏.</p>
            
            <div class="input-group">
                <input 
                    type="text" 
                    id="googleApiKeyInput" 
                    class="api-input" 
                    placeholder="AIzaSy..."
                    autocomplete="off"
                    autocapitalize="none"
                    inputmode="text"
                    spellcheck="false"
                    autofocus
                />
                <i class="fas fa-lock input-icon"></i>
            </div>
            
            <button id="saveApiKeyBtn" class="save-btn">
                <i class="fas fa-save"></i>
                <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–ª—é—á</span>
            </button>
            
            <a href="https://aistudio.google.com/apikey" target="_blank" class="get-key-link">
                <i class="fas fa-external-link-alt"></i>
                –ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á –±–µ—Å–ø–ª–∞—Ç–Ω–æ
            </a>
        </div>
    </div>

    <!-- –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ –±–æ–∫–∞–º -->
    <div class="side-decoration left">
        <div class="floating-element" style="top: 10%; animation-delay: 0s;"></div>
        <div class="floating-element" style="top: 30%; animation-delay: 1s;"></div>
        <div class="floating-element" style="top: 50%; animation-delay: 2s;"></div>
        <div class="floating-element" style="top: 70%; animation-delay: 0.5s;"></div>
        <div class="floating-element" style="top: 90%; animation-delay: 1.5s;"></div>
    </div>
    <div class="side-decoration right">
        <div class="floating-element" style="top: 15%; animation-delay: 0.7s;"></div>
        <div class="floating-element" style="top: 35%; animation-delay: 1.7s;"></div>
        <div class="floating-element" style="top: 55%; animation-delay: 0.3s;"></div>
        <div class="floating-element" style="top: 75%; animation-delay: 1.2s;"></div>
        <div class="floating-element" style="top: 95%; animation-delay: 0.8s;"></div>
    </div>

    <!-- –®–∞–ø–∫–∞ —Å–∞–π—Ç–∞ -->
    <header class="site-header">
        <div class="header-content">
            <h1 class="site-title">Music Connected Us AI DIAS</h1>
            <div class="header-subtitle">Intelligent Music Discovery</div>
        </div>
    </header>

    <!-- –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="main-layout">
        <!-- –õ–µ–≤–∞—è –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <aside class="sidebar left-sidebar">
            <div class="sidebar-header">
                <div class="status-badge" id="statusBadge">
                    <div class="status-dot" id="neuralStatus"></div>
                    <span id="statusText">–ì–æ—Ç–æ–≤</span>
                </div>
            </div>
            
            <div class="sidebar-section">
                <h3><i class="fas fa-sliders-h"></i> –¢–∏–ø –ø–æ–∏—Å–∫–∞</h3>
                <div class="search-type-buttons">
                    <button class="search-type-btn" onclick="setSearchType('melody')" data-type="melody">
                        <i class="fas fa-wave-square"></i>
                        <span>–ü–æ –Ω–∞–ø–µ–≤—É</span>
                    </button>
                    <button class="search-type-btn" onclick="setSearchType('lyrics')" data-type="lyrics">
                        <i class="fas fa-quote-right"></i>
                        <span>–ü–æ —Å—Ç—Ä–æ—á–∫–∞–º</span>
                    </button>
                    <button class="search-type-btn" onclick="setSearchType('mood')" data-type="mood">
                        <i class="fas fa-heartbeat"></i>
                        <span>–ü–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é</span>
                    </button>
                    <button class="search-type-btn" onclick="setSearchType('describe')" data-type="describe">
                        <i class="fas fa-film"></i>
                        <span>–ü–æ –æ–ø–∏—Å–∞–Ω–∏—é</span>
                    </button>
                </div>
            </div>

        </aside>

        <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —á–∞—Ç (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π) -->
        <main class="main-chat-container">
            <div class="chat-card">
                <div class="chat-header">
                    <h2><i class="fas fa-robot"></i> –ß–∞—Ç —Å –ò–ò</h2>
                </div>
                <div class="chat-messages" id="chatMessages">
                    <div class="message ai">
                        <div class="message-sender">
                        <i class="fas fa-robot"></i> –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ò–ò
                        </div>
                        <div class="message-content">
                        üé∂ –ü—Ä–∏–≤–µ—Ç! –Ø –º—É–∑—ã–∫–∞–ª—å–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç. –ú–æ–≥—É –ø–æ–º–æ—á—å —Å –ø–æ–∏—Å–∫–æ–º –º—É–∑—ã–∫–∏, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏, –∞–Ω–∞–ª–∏–∑–æ–º —Ç—Ä–µ–∫–æ–≤ –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º –∂–∞–Ω—Ä–æ–≤.
                        </div>
                    </div>
                </div>
                
                
                <div class="chat-input-container">
                    <button id="voiceButton" class="voice-btn" onclick="toggleVoiceInput()" title="–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <input type="text" id="chatInput" 
                           placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –æ –º—É–∑—ã–∫–µ..." 
                           autocomplete="off">
                    <button id="sendMessage">
                        <span>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</span>
                        <i class="fas fa-rocket"></i>
                    </button>
                </div>
                <div id="voiceStatus" class="voice-status">
                    <i class="fas fa-circle"></i>
                    <span>–°–ª—É—à–∞—é... –ù–∞–ø–æ–π—Ç–µ –º–µ–ª–æ–¥–∏—é –∏–ª–∏ —Å–∫–∞–∂–∏—Ç–µ –∑–∞–ø—Ä–æ—Å</span>
                </div>
            </div>
        </main>

        <!-- –ü—Ä–∞–≤–∞—è –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <aside class="sidebar right-sidebar">
            <div class="sidebar-section">
                <h3><i class="fas fa-lightbulb"></i> –ë—ã—Å—Ç—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã</h3>
                <div class="quick-actions">
                    <button class="quick-btn" onclick="quickSearch('–ù–∞–π–¥–∏ –ø–µ—Å–Ω—é –ø—Ä–æ –Ω–æ—á–Ω–æ–π –≥–æ—Ä–æ–¥')">
                        üåÉ –ù–æ—á–Ω–æ–π –≥–æ—Ä–æ–¥
                    </button>
                    <button class="quick-btn" onclick="quickSearch('–ß—Ç–æ –ø–æ—Å–ª—É—à–∞—Ç—å –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏?')">
                        üí™ –î–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
                    </button>
                    <button class="quick-btn" onclick="quickSearch('–†–æ–∫-–±–∞–ª–ª–∞–¥—ã 80-—Ö –≥–æ–¥–æ–≤')">
                        üé∏ –†–æ–∫ 80-—Ö
                    </button>
                    <button class="quick-btn" onclick="quickSearch('–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –º—É–∑—ã–∫–∞ –¥–ª—è –≤–µ—á–µ—Ä–∏–Ω–∫–∏')">
                        üéâ –î–ª—è –≤–µ—á–µ—Ä–∏–Ω–∫–∏
                    </button>
                    <button class="quick-btn" onclick="quickSearch('–ì—Ä—É—Å—Ç–Ω–∞—è –º—É–∑—ã–∫–∞ –¥–ª—è –≤–µ—á–µ—Ä–∞')">
                        üò¢ –ì—Ä—É—Å—Ç–Ω–∞—è
                    </button>
                    <button class="quick-btn" onclick="quickSearch('–†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –º—É–∑—ã–∫–∞')">
                        ‚ù§Ô∏è –†–æ–º–∞–Ω—Ç–∏–∫–∞
                    </button>
                </div>
            </div>

            <div class="sidebar-section">
                <h3><i class="fas fa-star"></i> –ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–∞—Ö–æ–¥–∫–∏</h3>
                <div id="recentFinds" class="recent-finds">
                    <p style="color: var(--gray); font-size: 0.9rem;">–ü–æ–∫–∞ –Ω–µ—Ç –Ω–∞—Ö–æ–¥–æ–∫</p>
                </div>
            </div>
        </aside>
    </div>

    <script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let chatHistory = [];
    let currentSearchType = null;
    let isVoiceListening = false;
    let currentApiKey = null;
    
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–ª—é—á–∞
    window.currentApiKey = null;
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    console.log('üîë –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–π Google AI API...');
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∫–ª—é—á–∞
    function checkApiKeyAvailable() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∫–ª—é—á–µ–π
        const sources = [];
        
        // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º keys.js
        if (window.API_CONFIG && window.API_CONFIG.googleKeys && window.API_CONFIG.googleKeys.length > 0) {
            sources.push(...window.API_CONFIG.googleKeys);
            console.log('‚úÖ –ö–ª—é—á–∏ –∏–∑ keys.js:', window.API_CONFIG.googleKeys.length);
        }
        
        // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º CONFIG
        if (window.CONFIG && window.CONFIG.GOOGLE_AI && window.CONFIG.GOOGLE_AI.API_KEYS && window.CONFIG.GOOGLE_AI.API_KEYS.length > 0) {
            sources.push(...window.CONFIG.GOOGLE_AI.API_KEYS);
            console.log('‚úÖ –ö–ª—é—á–∏ –∏–∑ CONFIG:', window.CONFIG.GOOGLE_AI.API_KEYS.length);
        }
        
        // 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º window.currentApiKey
        if (window.currentApiKey && typeof window.currentApiKey === 'string' && window.currentApiKey.length >= 20) {
            sources.push(window.currentApiKey);
            console.log('‚úÖ –ö–ª—é—á –∏–∑ window.currentApiKey');
        }
        
        // 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage
        try {
            const savedKey = localStorage.getItem('music_ai_google_key');
            if (savedKey && savedKey.length >= 20) {
                sources.push(savedKey);
                console.log('‚úÖ –ö–ª—é—á –∏–∑ localStorage');
            }
        } catch (e) {
            console.log('‚ö†Ô∏è localStorage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
        }
        
        // –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å
        const uniqueKeys = [...new Set(sources.filter(k => k && typeof k === 'string' && k.length >= 20))];
        
        console.log('üìã –í—Å–µ–≥–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–ª—é—á–µ–π:', uniqueKeys.length);
        
        if (uniqueKeys.length > 0) {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–≤—ã–π –∫–ª—é—á –∫–∞–∫ —Ç–µ–∫—É—â–∏–π
            currentApiKey = uniqueKeys[0];
            window.currentApiKey = currentApiKey;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º AI Core –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            if (window.aiCore) {
                window.aiCore.apiKeys = uniqueKeys;
                window.aiCore.currentKeyIndex = 0;
                console.log(`‚úÖ AI Core –æ–±–Ω–æ–≤–ª–µ–Ω. –ö–ª—é—á–µ–π: ${uniqueKeys.length}`);
            }
            
            return true;
        }
        
        return false;
    }
    
    // ==================== –û–°–ù–û–í–ù–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
    
    document.addEventListener('DOMContentLoaded', async function() {
        console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
        updateStatus('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–π...', 'warning');
        
        // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
        setTimeout(async () => {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–µ–π
            const hasKeys = checkApiKeyAvailable();
            
            if (hasKeys) {
                console.log('‚úÖ –ö–ª—é—á–∏ –Ω–∞–π–¥–µ–Ω—ã, —Å–∫—Ä—ã–≤–∞—é –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ');
                hideApiKeyModal();
                updateStatus('‚úÖ –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ', 'active');
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                document.getElementById('sendMessage').disabled = false;
                document.getElementById('chatInput').placeholder = "–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –æ –º—É–∑—ã–∫–µ...";
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                if (!localStorage.getItem('music_ai_welcome_shown')) {
                    addMessageToChat("üéµ **–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!**\n\n–Ø –≤–∞—à –º—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫. –ú–æ–≥—É –ø–æ–º–æ—á—å –Ω–∞–π—Ç–∏ –º—É–∑—ã–∫—É –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é, –Ω–∞–ø–µ–≤—É –∏–ª–∏ —Å—Ç—Ä–æ—á–∫–∞–º —Ç–µ–∫—Å—Ç–∞.", 'ai');
                    localStorage.setItem('music_ai_welcome_shown', 'true');
                }
            } else {
                console.log('‚ùå –ö–ª—é—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –ø–æ–∫–∞–∑—ã–≤–∞—é –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ');
                showApiKeyModal();
                updateStatus('‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è API –∫–ª—é—á', 'error');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ
                addMessageToChat("üîë **–¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞**\n\n–î–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω—É–∂–µ–Ω Google AI API –∫–ª—é—á. –í–≤–µ–¥–∏—Ç–µ –µ–≥–æ –≤ –ø–æ—è–≤–∏–≤—à–µ–º—Å—è –æ–∫–Ω–µ.\n\n–í—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫–ª—é—á –ø–æ —Å—Å—ã–ª–∫–µ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ.", 'ai');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º AI Core –µ—Å–ª–∏ –æ–Ω –±—ã–ª —Å–æ–∑–¥–∞–Ω
            if (window.aiCore && hasKeys) {
                // –í—ã–∑—ã–≤–∞–µ–º auto-discovery –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
                setTimeout(() => {
                    if (window.aiCore.initAutoDiscovery) {
                        window.aiCore.initAutoDiscovery();
                    }
                }, 1000);
            }
        }, 500);
    });
    
    // ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ú–û–î–ê–õ–¨–ù–´–ú –û–ö–ù–û–ú ====================
    
    function showApiKeyModal() {
        const modal = document.getElementById('settingsModal');
        if (modal) {
            modal.classList.remove('hidden');
            modal.style.display = 'flex';
            modal.style.opacity = '1';
            modal.style.visibility = 'visible';
            modal.style.zIndex = '2147483647';
            
            // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
            const apiInput = document.getElementById('googleApiKeyInput');
            if (apiInput) {
                setTimeout(() => {
                    apiInput.focus();
                }, 300);
            }
        }
    }
    
    function hideApiKeyModal() {
        const modal = document.getElementById('settingsModal');
        if (modal) {
            modal.classList.add('hidden');
            modal.style.display = 'none';
            modal.style.opacity = '0';
            modal.style.visibility = 'hidden';
        }
    }
    
    // ==================== –û–ë–†–ê–ë–û–¢–ö–ê –°–û–•–†–ê–ù–ï–ù–ò–Ø –ö–õ–Æ–ß–ê ====================
    
    function setupApiKeyHandlers() {
        const modal = document.getElementById('settingsModal');
        const saveBtn = document.getElementById('saveApiKeyBtn');
        const apiInput = document.getElementById('googleApiKeyInput');
        
        if (!saveBtn || !apiInput) return;
        
        function saveApiKey() {
            const key = apiInput.value.trim();
            
            if (!key || key.length < 20) {
                apiInput.style.borderColor = '#ef4444';
                apiInput.placeholder = "‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π API –∫–ª—é—á";
                setTimeout(() => {
                    apiInput.style.borderColor = '';
                    apiInput.placeholder = "AIzaSy...";
                }, 2000);
                apiInput.focus();
                return false;
            }
            
            try {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª—é—á –≥–ª–æ–±–∞–ª—å–Ω–æ
                window.currentApiKey = key;
                currentApiKey = key;
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –¥–ª—è –±—É–¥—É—â–∏—Ö —Å–µ—Å—Å–∏–π
                localStorage.setItem('music_ai_google_key', key);
                
                console.log('‚úÖ –ö–ª—é—á —Å–æ—Ö—Ä–∞–Ω–µ–Ω:', key.substring(0, 20) + '...');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º AI Core
                if (window.aiCore) {
                    // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –∫–ª—é—á–∏
                    const allKeys = [key];
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª—é—á–∏ –∏–∑ –¥—Ä—É–≥–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
                    if (window.API_CONFIG?.googleKeys) {
                        allKeys.push(...window.API_CONFIG.googleKeys);
                    }
                    if (window.CONFIG?.GOOGLE_AI?.API_KEYS) {
                        allKeys.push(...window.CONFIG.GOOGLE_AI.API_KEYS);
                    }
                    
                    // –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã
                    const uniqueKeys = [...new Set(allKeys.filter(k => k && typeof k === 'string' && k.length >= 20))];
                    
                    window.aiCore.apiKeys = uniqueKeys;
                    window.aiCore.currentKeyIndex = 0;
                    
                    console.log(`‚úÖ AI Core –æ–±–Ω–æ–≤–ª–µ–Ω. –ö–ª—é—á–µ–π: ${uniqueKeys.length}`);
                    
                    // –ó–∞–ø—É—Å–∫–∞–µ–º auto-discovery
                    setTimeout(() => {
                        if (window.aiCore.initAutoDiscovery) {
                            window.aiCore.initAutoDiscovery();
                        }
                    }, 500);
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö
                const originalHtml = saveBtn.innerHTML;
                saveBtn.innerHTML = '<i class="fas fa-check"></i> <span>–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!</span>';
                saveBtn.style.background = 'linear-gradient(90deg, #10b981, #059669)';
                
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                setTimeout(() => {
                    hideApiKeyModal();
                    updateStatus('‚úÖ API –∫–ª—é—á —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω', 'active');
                    
                    // –í–∫–ª—é—á–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                    document.getElementById('sendMessage').disabled = false;
                    document.getElementById('chatInput').placeholder = "–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –æ –º—É–∑—ã–∫–µ...";
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ
                    addMessageToChat("‚úÖ **API –∫–ª—é—á —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!**\n\n–¢–µ–ø–µ—Ä—å —è –º–æ–≥—É –∏—Å–∫–∞—Ç—å –º—É–∑—ã–∫—É —Å –ø–æ–º–æ—â—å—é Google Gemini AI.", 'ai');
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                    setTimeout(() => {
                        saveBtn.innerHTML = originalHtml;
                        saveBtn.style.background = '';
                    }, 1500);
                }, 500);
                
                return true;
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–ª—é—á–∞:', error);
                alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
                return false;
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        saveBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            saveApiKey();
        });
        
        apiInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                saveApiKey();
            }
        });
        
        // –ú–æ–±–∏–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
        saveBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            e.stopPropagation();
            saveApiKey();
        }, { passive: false });
    }
    
    // –í—ã–∑—ã–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
    setTimeout(setupApiKeyHandlers, 1000);
    
    // ==================== –û–°–ù–û–í–ù–û–ô –ò–ò –ß–ê–¢ ====================
    
    async function sendMessageToNeural() {
        const input = document.getElementById('chatInput');
        const message = input.value.trim();
        
        if (!message) return;
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        addMessageToChat(message, 'user');
        input.value = '';
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–∞
        if (!checkApiKeyAvailable()) {
            addMessageToChat("‚ùå **API –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω**\n\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–ª—é—á Google AI API –≤ –ø–æ—è–≤–∏–≤—à–µ–º—Å—è –æ–∫–Ω–µ.", 'ai');
            showApiKeyModal();
            return;
        }
        
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º ai-core –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
        if (window.aiCore) {
            showTypingIndicator(true);
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —É ai-core –µ—Å—Ç—å –∫–ª—é—á–∏
                if (!window.aiCore.apiKeys || window.aiCore.apiKeys.length === 0) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–ª—é—á–∏
                    checkApiKeyAvailable();
                    
                    if (!window.aiCore.apiKeys || window.aiCore.apiKeys.length === 0) {
                        throw new Error('API –∫–ª—é—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                    }
                }
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º processQuery –≤–º–µ—Å—Ç–æ processWithOpenRouter –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
                await window.aiCore.processQuery(message);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ ai-core:', error);
                
                // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –∫–ª—é—á–∞–º–∏, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                if (error.message.includes('API –∫–ª—é—á') || 
                    error.message.includes('–ö–ª—é—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã') ||
                    (error.message && error.message.includes('–∫–ª—é—á'))) {
                    
                    addMessageToChat("‚ùå **–ü—Ä–æ–±–ª–µ–º–∞ —Å API –∫–ª—é—á–æ–º**\n\n–í–æ–∑–º–æ–∂–Ω–æ, –∫–ª—é—á –Ω–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ –∏—Å—Ç–µ–∫ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∏ –≤–≤–µ–¥–∏—Ç–µ –∫–ª—é—á —Å–Ω–æ–≤–∞.", 'ai');
                    showApiKeyModal();
                } else {
                    addMessageToChat(`‚ùå **–û—à–∏–±–∫–∞ –ò–ò:**\n\n${error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}\n\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.`, 'ai');
                }
            } finally {
                showTypingIndicator(false);
                scrollChatToBottom();
            }
            return;
        }
        
        // Fallback –Ω–∞ —Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥, –µ—Å–ª–∏ ai-core –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω
        addMessageToChat("‚ö†Ô∏è **AI Core –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω**\n\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞.", 'ai');
    }
    
    // ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
    
    function updateStatus(text, state) {
        const statusDot = document.getElementById('neuralStatus');
        const statusText = document.getElementById('statusText');
        
        if (statusText) statusText.textContent = text;
        if (statusDot) {
            statusDot.className = 'status-dot';
            
            if (state === 'active') {
                statusDot.style.background = 'var(--success)';
            } else if (state === 'error') {
                statusDot.style.background = 'var(--danger)';
            } else if (state === 'warning') {
                statusDot.style.background = 'var(--warning)';
            }
        }
    }
    
    function addMessageToChat(text, sender, messageId = null) {
        const chat = document.getElementById('chatMessages');
        if (!chat) return;
        
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${sender}`;
        
        if (messageId) {
            messageDiv.id = messageId;
            messageDiv.setAttribute('data-message-id', messageId);
        }
        
        const senderDiv = document.createElement('div');
        senderDiv.className = 'message-sender';
        
        if (sender === 'ai') {
            senderDiv.innerHTML = `<i class="fas fa-robot"></i> –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ò–ò`;
        } else {
            senderDiv.innerHTML = `<i class="fas fa-user"></i> –í—ã`;
        }
        
        const contentDiv = document.createElement('div');
        contentDiv.className = 'message-content';
        
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç: —É–±–∏—Ä–∞–µ–º –∑–∞—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ –∏ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ–º HTML
        let processedText = text
            .replace(/~~(.*?)~~/g, '$1')
            .replace(/<s[^>]*>(.*?)<\/s>/gi, '$1')
            .replace(/<del[^>]*>(.*?)<\/del>/gi, '$1')
            .replace(/<strike[^>]*>(.*?)<\/strike>/gi, '$1')
            .replace(/[\u0336\u0335\u0338]/g, '')
            .replace(/<[^>]+>/g, '')
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#039;')
            .replace(/\n/g, '<br>');
        
        contentDiv.innerHTML = processedText;
        
        if (sender === 'ai') {
            const signature = document.createElement('div');
            signature.className = 'neural-signature';
            signature.innerHTML = `<i class="fas fa-cloud"></i> Google Gemini ‚Ä¢ –£–º–Ω—ã–π –ø–æ–∏—Å–∫`;
            contentDiv.appendChild(signature);
        }
        
        messageDiv.appendChild(senderDiv);
        messageDiv.appendChild(contentDiv);
        chat.appendChild(messageDiv);
        
        scrollChatToBottom();
        
        return messageDiv;
    }
    
    // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ ai-core.js
    window.addMessageToChat = addMessageToChat;
    
    function updateMessageInChat(messageId, newText) {
        const messageDiv = document.getElementById(messageId);
        if (messageDiv) {
            const contentDiv = messageDiv.querySelector('.message-content');
            if (contentDiv) {
                const signature = contentDiv.querySelector('.neural-signature');
                
                let processedText = newText
                    .replace(/~~(.*?)~~/g, '$1')
                    .replace(/<s[^>]*>(.*?)<\/s>/gi, '$1')
                    .replace(/<del[^>]*>(.*?)<\/del>/gi, '$1')
                    .replace(/<strike[^>]*>(.*?)<\/strike>/gi, '$1')
                    .replace(/[\u0336\u0335\u0338]/g, '')
                    .replace(/<[^>]+>/g, '')
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#039;')
                    .replace(/\n/g, '<br>');
                
                contentDiv.innerHTML = processedText;
                if (signature) {
                    contentDiv.appendChild(signature);
                }
                scrollChatToBottom();
            }
        }
    }
    
    function removeMessageFromChat(messageId) {
        const messageDiv = document.getElementById(messageId);
        if (messageDiv) {
            messageDiv.remove();
        }
    }
    
    window.updateMessageInChat = updateMessageInChat;
    window.removeMessageFromChat = removeMessageFromChat;
    
    function showTypingIndicator(show) {
        const sendBtn = document.getElementById('sendMessage');
        if (sendBtn) {
            sendBtn.disabled = show;
        }
    }
    
    function scrollChatToBottom() {
        const chat = document.getElementById('chatMessages');
        if (chat) {
            chat.scrollTop = chat.scrollHeight;
        }
    }
    
    // ==================== –ì–û–õ–û–°–û–í–û–ô –í–í–û–î ====================
    
    function toggleVoiceInput() {
        if (!window.aiCore) {
            addMessageToChat('‚ùå AI Core –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'ai');
            return;
        }
        
        const voiceBtn = document.getElementById('voiceButton');
        const voiceStatus = document.getElementById('voiceStatus');
        
        if (!isVoiceListening) {
            // –í–∫–ª—é—á–∞–µ–º –º–∏–∫—Ä–æ—Ñ–æ–Ω
            if (window.aiCore.startVoiceInput) {
                window.aiCore.startVoiceInput();
            }
            isVoiceListening = true;
            
            voiceBtn.classList.add('listening');
            voiceBtn.innerHTML = '<i class="fas fa-stop"></i>';
            if (voiceStatus) {
                voiceStatus.classList.add('active');
                voiceStatus.style.display = 'block';
            }
        } else {
            // –í—ã–∫–ª—é—á–∞–µ–º –º–∏–∫—Ä–æ—Ñ–æ–Ω
            stopVoiceUI();
            if (window.aiCore.stopVoiceInput) {
                window.aiCore.stopVoiceInput();
            }
        }
    }
    
    function stopVoiceUI() {
        const voiceBtn = document.getElementById('voiceButton');
        const voiceStatus = document.getElementById('voiceStatus');
        
        isVoiceListening = false;
        
        if (voiceBtn) {
            voiceBtn.classList.remove('listening');
            voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
        }
        if (voiceStatus) {
            voiceStatus.classList.remove('active');
            voiceStatus.style.display = 'none';
        }
    }
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã–∫–ª—é—á–µ–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
    document.addEventListener('DOMContentLoaded', () => {
        setTimeout(() => {
            if (window.aiCore && window.aiCore.onVoiceInput) {
                const originalHandler = window.aiCore.onVoiceInput.bind(window.aiCore);
                window.aiCore.onVoiceInput = function(text) {
                    stopVoiceUI();
                    originalHandler(text);
                };
            }
        }, 1000);
    });
    
    // ==================== –ò–ù–¢–ï–†–§–ï–ô–°–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
    
    document.getElementById('sendMessage').addEventListener('click', sendMessageToNeural);
    
    document.getElementById('chatInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessageToNeural();
        }
    });
    
    function setSearchType(type) {
        currentSearchType = type;
        
        // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
        document.querySelectorAll('.search-type-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–Ω–æ–ø–∫–µ
        const btn = document.querySelector(`[data-type="${type}"]`);
        if (btn) btn.classList.add('active');
        
        // –ú–µ–Ω—è–µ–º placeholder
        const placeholders = {
            melody: "–û–ø–∏—à–∏—Ç–µ –º–µ–ª–æ–¥–∏—é –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥ (–Ω–∞–ø–æ–π—Ç–µ)...",
            lyrics: "–í–≤–µ–¥–∏—Ç–µ —Å—Ç—Ä–æ—á–∫–∏ –∏–∑ –ø–µ—Å–Ω–∏ –∏–ª–∏ —Ç–µ–º—É —Ç–µ–∫—Å—Ç–∞...",
            mood: "–û–ø–∏—à–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: '–≥—Ä—É—Å—Ç–Ω—ã–π –æ—Å–µ–Ω–Ω–∏–π –≤–µ—á–µ—Ä')...",
            describe: "–û–ø–∏—à–∏—Ç–µ –∫–ª–∏–ø –∏–ª–∏ –∞—Ç–º–æ—Å—Ñ–µ—Ä—É (–Ω–∞–ø—Ä–∏–º–µ—Ä: '–Ω–µ–æ–Ω–æ–≤—ã–µ –æ–≥–Ω–∏, –Ω–æ—á–Ω–æ–π –≥–æ—Ä–æ–¥')..."
        };
        
        document.getElementById('chatInput').placeholder = placeholders[type] || "–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –æ –º—É–∑—ã–∫–µ...";
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
        if (type === 'melody') {
            addMessageToChat('üé§ **–†–µ–∂–∏–º –ø–æ–∏—Å–∫–∞ –ø–æ –Ω–∞–ø–µ–≤—É –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!**\n\n–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –∏ –Ω–∞–ø–æ–π—Ç–µ –º–µ–ª–æ–¥–∏—é, –∏–ª–∏ –æ–ø–∏—à–∏—Ç–µ –µ—ë —Å–ª–æ–≤–∞–º–∏.', 'ai');
        }
    }
    
    function quickSearch(query) {
        document.getElementById('chatInput').value = query;
        sendMessageToNeural();
    }
    
    function addRecentFind(trackName, artist) {
        const recentFinds = document.getElementById('recentFinds');
        let finds = JSON.parse(localStorage.getItem('musicAI_recentFinds') || '[]');
        
        finds.unshift({ track: trackName, artist: artist, time: Date.now() });
        finds = finds.slice(0, 5);
        
        localStorage.setItem('musicAI_recentFinds', JSON.stringify(finds));
        updateRecentFinds();
    }
    
    function updateRecentFinds() {
        const recentFinds = document.getElementById('recentFinds');
        const finds = JSON.parse(localStorage.getItem('musicAI_recentFinds') || '[]');
        
        if (finds.length === 0) {
            recentFinds.innerHTML = '<p style="color: var(--gray); font-size: 0.9rem;">–ü–æ–∫–∞ –Ω–µ—Ç –Ω–∞—Ö–æ–¥–æ–∫</p>';
            return;
        }
        
        recentFinds.innerHTML = finds.map(f => 
            `<div class="recent-find-item">üéµ ${f.track} - ${f.artist}</div>`
        ).join('');
    }
    
    // –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π
    window.sendMessageToNeural = sendMessageToNeural;
    window.setSearchType = setSearchType;
    window.toggleVoiceInput = toggleVoiceInput;
    window.quickSearch = quickSearch;
    window.showApiKeyModal = showApiKeyModal;
    window.hideApiKeyModal = hideApiKeyModal;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –Ω–∞—Ö–æ–¥–æ–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    setTimeout(updateRecentFinds, 1000);
    </script>

<style>
    /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
    #settingsModal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(15, 23, 42, 0.95);
        backdrop-filter: blur(15px);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 2147483647;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s, visibility 0.3s;
    }
    
    #settingsModal:not(.hidden) {
        display: flex;
        opacity: 1;
        visibility: visible;
    }
    
    .settings-content {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
        backdrop-filter: blur(30px);
        border-radius: 30px;
        padding: 40px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 25px 70px rgba(0, 0, 0, 0.4);
        width: 90%;
        max-width: 500px;
        text-align: center;
    }
    
    .modal-icon {
        font-size: 4rem;
        color: var(--primary);
        margin-bottom: 20px;
    }
    
    .settings-title {
        font-size: 2rem;
        color: var(--light);
        margin-bottom: 15px;
        background: var(--gradient);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
    }
    
    .settings-desc {
        color: var(--gray);
        margin-bottom: 30px;
        line-height: 1.6;
    }
    
    .input-group {
        position: relative;
        margin-bottom: 25px;
    }
    
    .api-input {
        width: 100%;
        padding: 18px 25px 18px 50px;
        background: rgba(255, 255, 255, 0.08);
        border: 2px solid rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        color: var(--light);
        font-size: 1rem;
        transition: all 0.3s;
    }
    
    .api-input:focus {
        outline: none;
        border-color: var(--primary);
        background: rgba(255, 255, 255, 0.12);
        box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
    }
    
    .input-icon {
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--primary);
        font-size: 1.2rem;
    }
    
    .save-btn {
        width: 100%;
        padding: 18px;
        background: var(--gradient);
        border: none;
        border-radius: 15px;
        color: white;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        margin-bottom: 20px;
    }
    
    .save-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
    }
    
    .get-key-link {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        color: var(--accent);
        text-decoration: none;
        font-size: 0.9rem;
        transition: all 0.3s;
    }
    
    .get-key-link:hover {
        color: var(--primary);
        transform: translateY(-2px);
    }
</style>
</body>
</html>
